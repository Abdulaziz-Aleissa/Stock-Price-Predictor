<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Stock Price Predictor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div class="theme-switch">
        <div class="switch-track">
            <div class="switch-icons">
                <div class="sun">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
                </div>
                <div class="moon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                </div>
            </div>
            <div class="switch-circle"></div>
        </div>
    </div>

    <div class="notifications-container">
        {% for notification in notifications %}
        <div class="notification-item">
            {{ notification.message }}
            <a href="{{ url_for('mark_notification_read', notification_id=notification.id) }}" 
               class="btn-close notification-close"></a>
        </div>
        {% endfor %}
    </div>

    <div class="content-box dashboard">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Dashboard</h1>
            <div>
                <a href="{{ url_for('financial_literacy') }}" class="btn btn-custom me-2">ðŸ“š Financial Literacy</a>
                <a href="{{ url_for('index') }}" class="btn btn-custom me-2">New Prediction</a>
                <button class="btn btn-custom me-2" data-bs-toggle="modal" data-bs-target="#stockScoringModal">
                    Stock Scoring
                </button>
                <a href="{{ url_for('logout') }}" class="btn btn-outline-danger">Logout</a>
            </div>
        </div>

        <div class="row">
            <!-- Portfolio Summary Card -->
            <div class="col-12 mb-4">
                <div class="metrics-card">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="summary-item">
                                <div class="label">Total Value</div>
                                <div class="value">${{ "%.2f"|format(summary.total_value) }}</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="summary-item">
                                <div class="label">Total Cost</div>
                                <div class="value">${{ "%.2f"|format(summary.total_cost) }}</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="summary-item">
                                <div class="label">Total P/L</div>
                                <div class="value {{ 'positive-change' if summary.total_profit_loss > 0 else 'negative-change' }}">
                                    ${{ "%.2f"|format(summary.total_profit_loss) }}
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="summary-item">
                                <div class="label">Total Return</div>
                                <div class="value {{ 'positive-change' if summary.total_return_percent > 0 else 'negative-change' }}">
                                    {{ "%.2f"|format(summary.total_return_percent) }}%
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Portfolio Section -->
            <div class="col-md-6">
                <div class="metrics-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2>Portfolio</h2>
                        <button class="btn btn-custom btn-sm" data-bs-toggle="modal" data-bs-target="#addPortfolioModal">
                            Add Stock
                        </button>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-dark table-hover">
                            <thead>
                                <tr>
                                    <th>Symbol</th>
                                    <th>Shares</th>
                                    <th>Buy Price</th>
                                    <th>Current</th>
                                    <th>Value</th>
                                    <th>P/L</th>
                                    <th>Change</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in portfolio %}
                                <tr>
                                    <td>{{ item.symbol }}</td>
                                    <td>{{ "%.2f"|format(item.shares) }}</td>
                                    <td>${{ "%.2f"|format(item.purchase_price) }}</td>
                                    <td>${{ "%.2f"|format(item.current_price) }}</td>
                                    <td>${{ "%.2f"|format(item.position_value) }}</td>
                                    <td class="{{ 'positive-change' if item.profit_loss > 0 else 'negative-change' }}">
                                        ${{ "%.2f"|format(item.profit_loss) }}
                                    </td>
                                    <td class="{{ 'positive-change' if item.change_percent > 0 else 'negative-change' }}">
                                        {{ "%.2f"|format(item.change_percent) }}%
                                    </td>
                                    <td>
                                        <a href="{{ url_for('remove_from_portfolio', item_id=item.id) }}" 
                                           class="btn btn-outline-danger btn-sm">Remove</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Watchlist Section -->
            <div class="col-md-6">
                <div class="metrics-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2>Watchlist</h2>
                        <button class="btn btn-custom btn-sm" data-bs-toggle="modal" data-bs-target="#addWatchlistModal">
                            Add Stock
                        </button>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-dark table-hover">
                            <thead>
                                <tr>
                                    <th>Symbol</th>
                                    <th>Target</th>
                                    <th>Current</th>
                                    <th>Distance</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in watchlist %}
                                <tr>
                                    <td>{{ item.symbol }}</td>
                                    <td>${{ "%.2f"|format(item.target_price) }}</td>
                                    <td>${{ "%.2f"|format(item.current_price) }}</td>
                                    <td class="{{ 'positive-change' if item.current_price >= item.target_price else 'negative-change' }}">
                                        {{ "%.1f"|format(item.percent_to_target) }}%
                                    </td>
                                    <td>
                                        <a href="{{ url_for('remove_from_watchlist', item_id=item.id) }}" 
                                           class="btn btn-outline-danger btn-sm">Remove</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Price Alerts Section -->
            <div class="col-md-12 mt-4">
                <div class="metrics-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2>Price Alerts</h2>
                        <button class="btn btn-custom btn-sm" data-bs-toggle="modal" data-bs-target="#addAlertModal">
                            Add Alert
                        </button>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-dark table-hover">
                            <thead>
                                <tr>
                                    <th>Symbol</th>
                                    <th>Condition</th>
                                    <th>Target Price</th>
                                    <th>Current Price</th>
                                    <th>Status</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for alert in alerts %}
                                <tr>
                                    <td>{{ alert.symbol }}</td>
                                    <td>Goes {{ alert.condition }}</td>
                                    <td>${{ "%.2f"|format(alert.target_price) }}</td>
                                    <td>${{ "%.2f"|format(alert.current_price) }}</td>
                                    <td>
                                        {% if alert.is_active %}
                                        <span class="badge bg-success">Active</span>
                                        {% else %}
                                        <span class="badge bg-secondary">Triggered</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <a href="{{ url_for('remove_alert', alert_id=alert.id) }}" 
                                           class="btn btn-outline-danger btn-sm">Remove</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Stock Comparison Section -->
            <div class="col-md-12 mt-4">
                <div class="metrics-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2>Stock Comparison</h2>
                        <button class="btn btn-custom btn-sm" data-bs-toggle="modal" data-bs-target="#compareStocksModal">
                            Compare Stocks
                        </button>
                    </div>
                    <div id="comparisonChart"></div>
                </div>
            </div>

            <!-- Advanced Analytics Section -->
            <div class="col-md-12 mt-4">
                <div class="metrics-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2>Advanced Analytics</h2>
                        <div class="btn-group" role="group">
                            <button class="btn btn-custom btn-sm" data-bs-toggle="modal" data-bs-target="#monteCarloModal">
                                ðŸ“Š Monte Carlo
                            </button>
                            <button class="btn btn-custom btn-sm" data-bs-toggle="modal" data-bs-target="#backtestingModal">
                                ðŸ“ˆ Backtesting
                            </button>
                            <button class="btn btn-custom btn-sm" data-bs-toggle="modal" data-bs-target="#optionsPricingModal">
                                ðŸŽ¯ Options Pricing
                            </button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="analytics-feature">
                                <h5>Monte Carlo Simulations</h5>
                                <p>Risk analysis through probabilistic modeling of future price movements</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="analytics-feature">
                                <h5>Backtesting Framework</h5>
                                <p>Test trading strategies against historical data to evaluate performance</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="analytics-feature">
                                <h5>Options Pricing Models</h5>
                                <p>Black-Scholes pricing with Greeks calculation for options strategies</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add to Portfolio Modal -->
    <div class="modal fade" id="addPortfolioModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add to Portfolio</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form action="{{ url_for('add_to_portfolio') }}" method="POST">
                        <div class="mb-3">
                            <input type="text" class="form-control" name="symbol" placeholder="Stock Symbol" required>
                        </div>
                        <div class="mb-3">
                            <input type="number" class="form-control" name="shares" placeholder="Number of Shares" step="0.01" required>
                        </div>
                        <div class="mb-3">
                            <input type="number" class="form-control" name="purchase_price" placeholder="Purchase Price" step="0.01" required>
                        </div>
                        <button type="submit" class="btn btn-custom w-100">Add to Portfolio</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Add to Watchlist Modal -->
    <div class="modal fade" id="addWatchlistModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add to Watchlist</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form action="{{ url_for('add_to_watchlist') }}" method="POST">
                        <div class="mb-3">
                            <input type="text" class="form-control" name="symbol" placeholder="Stock Symbol" required>
                        </div>
                        <div class="mb-3">
                            <input type="number" class="form-control" name="target_price" placeholder="Target Price" step="0.01" required>
                        </div>
                        <button type="submit" class="btn btn-custom w-100">Add to Watchlist</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Alert Modal -->
    <div class="modal fade" id="addAlertModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Price Alert</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form action="{{ url_for('add_alert') }}" method="POST">
                        <div class="mb-3">
                            <input type="text" class="form-control" name="symbol" placeholder="Stock Symbol" required>
                        </div>
                        <div class="mb-3">
                            <select class="form-control" name="condition" required>
                                <option value="above">Price Goes Above</option>
                                <option value="below">Price Goes Below</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <input type="number" class="form-control" name="target_price" placeholder="Target Price" step="0.01" required>
                        </div>
                        <button type="submit" class="btn btn-custom w-100">Set Alert</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Compare Stocks Modal -->
    <div class="modal fade" id="compareStocksModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Compare Stocks</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="compareStocksForm">
                        <div class="mb-3">
                            <input type="text" class="form-control" name="symbol1" placeholder="First Stock Symbol" required>
                        </div>
                        <div class="mb-3">
                            <input type="text" class="form-control" name="symbol2" placeholder="Second Stock Symbol" required>
                        </div>
                        <div class="mb-3">
                            <select class="form-control" name="timeframe">
                                <option value="1mo">1 Month</option>
                                <option value="3mo">3 Months</option>
                                <option value="6mo">6 Months</option>
                                <option value="1y">1 Year</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-custom w-100">Compare</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Stock Scoring Modal -->
    <div class="modal fade" id="stockScoringModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Stock Scoring & Analysis</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="stockScoringForm">
                        <div class="mb-3">
                            <label class="form-label">Stock Symbols (comma-separated for multiple)</label>
                            <input type="text" class="form-control" name="symbols" placeholder="e.g., AAPL, MSFT, GOOGL" required>
                            <div class="form-text">Enter one or more stock symbols separated by commas</div>
                        </div>
                        <button type="submit" class="btn btn-custom w-100">
                            <span class="spinner-border spinner-border-sm d-none" id="scoringSpinner"></span>
                            Analyze Stocks
                        </button>
                    </form>
                    
                    <div id="scoringResults" class="mt-4" style="display: none;">
                        <hr>
                        <h6>Analysis Results</h6>
                        <div class="table-responsive">
                            <table class="table table-dark table-hover">
                                <thead>
                                    <tr>
                                        <th>Symbol</th>
                                        <th>P/E</th>
                                        <th>P/B</th>
                                        <th>ROE</th>
                                        <th>EV/EBITDA</th>
                                        <th>RSI</th>
                                        <th>Volatility</th>
                                        <th>Total Score</th>
                                        <th>Recommendation</th>
                                    </tr>
                                </thead>
                                <tbody id="scoringTableBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div id="scoringError" class="alert alert-danger mt-3" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Monte Carlo Simulation Modal -->
    <div class="modal fade" id="monteCarloModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ðŸ“Š Monte Carlo Risk Analysis</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="monteCarloForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Stock Symbol</label>
                                    <input type="text" class="form-control" name="symbol" placeholder="e.g., AAPL" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Investment Amount ($)</label>
                                    <input type="number" class="form-control" name="investment_amount" value="10000" min="100" max="1000000" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Simulation Days</label>
                                    <input type="number" class="form-control" name="days" value="30" min="1" max="365" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Number of Simulations</label>
                                    <select class="form-control" name="simulations">
                                        <option value="1000">1,000 (Fast)</option>
                                        <option value="5000" selected>5,000 (Recommended)</option>
                                        <option value="10000">10,000 (Detailed)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-custom w-100">
                            <span class="spinner-border spinner-border-sm d-none" id="monteCarloSpinner"></span>
                            Run Monte Carlo Simulation
                        </button>
                    </form>
                    
                    <div id="monteCarloResults" class="mt-4" style="display: none;">
                        <hr>
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Risk Metrics</h6>
                                <div id="riskMetrics"></div>
                            </div>
                            <div class="col-md-6">
                                <h6>Price Scenarios</h6>
                                <div id="priceScenarios"></div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <h6>Simulation Visualization</h6>
                            <div id="monteCarloChart"></div>
                        </div>
                        <div class="mt-3">
                            <h6>Risk Assessment</h6>
                            <div id="riskRecommendations"></div>
                        </div>
                    </div>
                    
                    <div id="monteCarloError" class="alert alert-danger mt-3" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Backtesting Modal -->
    <div class="modal fade" id="backtestingModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ðŸ“ˆ Strategy Backtesting</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="backtestingForm">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Stock Symbol</label>
                                    <input type="text" class="form-control" name="symbol" placeholder="e.g., AAPL" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Strategy</label>
                                    <select class="form-control" name="strategy">
                                        <option value="buy_and_hold">Buy & Hold</option>
                                        <option value="moving_average_crossover" selected>Moving Average Crossover</option>
                                        <option value="rsi_strategy">RSI Strategy</option>
                                        <option value="macd_strategy">MACD Strategy</option>
                                        <option value="bollinger_bands">Bollinger Bands</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Initial Capital ($)</label>
                                    <input type="number" class="form-control" name="initial_capital" value="10000" min="1000" max="1000000" required>
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-custom w-100">
                            <span class="spinner-border spinner-border-sm d-none" id="backtestingSpinner"></span>
                            Run Backtest
                        </button>
                    </form>
                    
                    <div id="backtestingResults" class="mt-4" style="display: none;">
                        <hr>
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Performance Summary</h6>
                                <div id="performanceMetrics"></div>
                            </div>
                            <div class="col-md-6">
                                <h6>Key Statistics</h6>
                                <div id="backtestingStats"></div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <h6>Equity Curve</h6>
                            <div id="backtestingChart"></div>
                        </div>
                        <div class="mt-3">
                            <h6>Recent Trades</h6>
                            <div id="recentTrades"></div>
                        </div>
                    </div>
                    
                    <div id="backtestingError" class="alert alert-danger mt-3" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Options Pricing Modal -->
    <div class="modal fade" id="optionsPricingModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ðŸŽ¯ Black-Scholes Options Pricing</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs" id="optionsTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="single-option-tab" data-bs-toggle="tab" data-bs-target="#single-option" type="button" role="tab">
                                Single Option
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="option-strategy-tab" data-bs-toggle="tab" data-bs-target="#option-strategy" type="button" role="tab">
                                Option Strategies
                            </button>
                        </li>
                    </ul>
                    <div class="tab-content" id="optionsTabContent">
                        <!-- Single Option Tab -->
                        <div class="tab-pane fade show active" id="single-option" role="tabpanel">
                            <div class="mt-3">
                                <form id="optionsPricingForm">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">Stock Symbol</label>
                                                <input type="text" class="form-control" name="symbol" placeholder="e.g., AAPL" required>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">Strike Price ($)</label>
                                                <input type="number" class="form-control" name="strike_price" step="0.01" min="0.01" required>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">Days to Expiration</label>
                                                <input type="number" class="form-control" name="expiration_days" value="30" min="1" max="1825" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Option Type</label>
                                                <select class="form-control" name="option_type">
                                                    <option value="call">Call Option</option>
                                                    <option value="put">Put Option</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Custom Volatility (%) - Optional</label>
                                                <input type="number" class="form-control" name="custom_volatility" step="0.1" min="0.1" max="500" placeholder="Leave blank for historical">
                                            </div>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-custom w-100">
                                        <span class="spinner-border spinner-border-sm d-none" id="optionsPricingSpinner"></span>
                                        Calculate Option Price
                                    </button>
                                </form>
                                
                                <div id="optionsPricingResults" class="mt-4" style="display: none;">
                                    <hr>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <h6>Option Pricing</h6>
                                            <div id="optionPricing"></div>
                                        </div>
                                        <div class="col-md-6">
                                            <h6>The Greeks</h6>
                                            <div id="optionGreeks"></div>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <h6>Risk Analysis</h6>
                                        <div id="optionRiskAnalysis"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Option Strategy Tab -->
                        <div class="tab-pane fade" id="option-strategy" role="tabpanel">
                            <div class="mt-3">
                                <form id="optionStrategyForm">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">Stock Symbol</label>
                                                <input type="text" class="form-control" name="symbol" placeholder="e.g., AAPL" required>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">Strategy Type</label>
                                                <select class="form-control" name="strategy_type" id="strategyTypeSelect">
                                                    <option value="straddle">Long Straddle</option>
                                                    <option value="strangle">Long Strangle</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">Days to Expiration</label>
                                                <input type="number" class="form-control" name="expiration_days" value="30" min="1" max="1825" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="strategyStrikes">
                                        <!-- Strike inputs will be dynamically added here -->
                                    </div>
                                    <button type="submit" class="btn btn-custom w-100">
                                        <span class="spinner-border spinner-border-sm d-none" id="optionStrategySpinner"></span>
                                        Analyze Strategy
                                    </button>
                                </form>
                                
                                <div id="optionStrategyResults" class="mt-4" style="display: none;">
                                    <hr>
                                    <h6>Strategy Analysis</h6>
                                    <div id="strategyAnalysis"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="optionsPricingError" class="alert alert-danger mt-3" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
    <script>
    document.getElementById('compareStocksForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        
        fetch('/compare_stocks', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            compareStocks(data);
            const modal = bootstrap.Modal.getInstance(document.getElementById('compareStocksModal'));
            modal.hide();
        })
        .catch(error => {
            console.error('Error:', error);
        });
    });

    // Stock Scoring Form Handler
    document.getElementById('stockScoringForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const spinner = document.getElementById('scoringSpinner');
        const resultsDiv = document.getElementById('scoringResults');
        const errorDiv = document.getElementById('scoringError');
        const tableBody = document.getElementById('scoringTableBody');
        
        // Show loading state
        spinner.classList.remove('d-none');
        resultsDiv.style.display = 'none';
        errorDiv.style.display = 'none';
        
        fetch('/stock_scoring', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            spinner.classList.add('d-none');
            
            if (data.error) {
                errorDiv.textContent = data.error;
                errorDiv.style.display = 'block';
                return;
            }
            
            // Clear previous results
            tableBody.innerHTML = '';
            
            // Populate results table
            data.results.forEach(stock => {
                const row = tableBody.insertRow();
                
                // Recommendation badge class
                let badgeClass = 'bg-secondary';
                if (stock.recommendation === 'BUY') badgeClass = 'bg-success';
                else if (stock.recommendation === 'SELL') badgeClass = 'bg-danger';
                else if (stock.recommendation === 'HOLD') badgeClass = 'bg-warning';
                
                row.innerHTML = `
                    <td><strong>${stock.symbol}</strong></td>
                    <td>${stock.metrics.pe_ratio !== null ? stock.metrics.pe_ratio.toFixed(2) : 'N/A'}</td>
                    <td>${stock.metrics.pb_ratio !== null ? stock.metrics.pb_ratio.toFixed(2) : 'N/A'}</td>
                    <td>${stock.metrics.roe !== null ? stock.metrics.roe.toFixed(2) + '%' : 'N/A'}</td>
                    <td>${stock.metrics.ev_ebitda !== null ? stock.metrics.ev_ebitda.toFixed(2) : 'N/A'}</td>
                    <td>${stock.metrics.rsi !== null ? stock.metrics.rsi.toFixed(2) : 'N/A'}</td>
                    <td>${stock.metrics.volatility !== null ? (stock.metrics.volatility * 100).toFixed(2) + '%' : 'N/A'}</td>
                    <td><strong>${stock.total_score}</strong></td>
                    <td>
                        <span class="badge ${badgeClass}" data-bs-toggle="tooltip" title="${stock.reasoning}">
                            ${stock.recommendation}
                        </span>
                    </td>
                `;
            });
            
            // Initialize tooltips
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
            
            resultsDiv.style.display = 'block';
        })
        .catch(error => {
            spinner.classList.add('d-none');
            errorDiv.textContent = 'An error occurred while analyzing stocks. Please try again.';
            errorDiv.style.display = 'block';
            console.error('Error:', error);
        });
    });

    function compareStocks(data) {
        const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
        
        const trace1 = {
            x: data.symbol1.dates,
            y: data.symbol1.prices,
            name: data.symbol1.symbol,
            type: 'scatter',
            line: { width: 2 }
        };
        
        const trace2 = {
            x: data.symbol2.dates,
            y: data.symbol2.prices,
            name: data.symbol2.symbol,
            type: 'scatter',
            line: { width: 2 }
        };
        
        const layout = {
            title: 'Stock Price Comparison',
            paper_bgcolor: 'transparent',
            plot_bgcolor: 'transparent',
            font: { 
                color: isDark ? '#e0e0e0' : '#1a202c',
            },
            xaxis: {
                title: 'Date',
                gridcolor: isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)',
            },
            yaxis: {
                title: 'Price ($)',
                gridcolor: isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)',
            },
            showlegend: true,
            legend: {
                x: 0,
                y: 1,
                bgcolor: isDark ? 'rgba(0,0,0,0.5)' : 'rgba(255,255,255,0.5)'
            }
        };
        
        Plotly.newPlot('comparisonChart', [trace1, trace2], layout);
    }

    // Update comparison chart when theme changes
    document.querySelector('.theme-switch').addEventListener('click', () => {
        const chartDiv = document.getElementById('comparisonChart');
        if (chartDiv.data) {
            compareStocks({
                symbol1: {
                    symbol: chartDiv.data[0].name,
                    dates: chartDiv.data[0].x,
                    prices: chartDiv.data[0].y
                },
                symbol2: {
                    symbol: chartDiv.data[1].name,
                    dates: chartDiv.data[1].x,
                    prices: chartDiv.data[1].y
                }
            });
        }
    });

    // Monte Carlo Simulation Form Handler
    document.getElementById('monteCarloForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const spinner = document.getElementById('monteCarloSpinner');
        const resultsDiv = document.getElementById('monteCarloResults');
        const errorDiv = document.getElementById('monteCarloError');
        
        // Show loading state
        spinner.classList.remove('d-none');
        resultsDiv.style.display = 'none';
        errorDiv.style.display = 'none';
        
        fetch('/monte_carlo_simulation', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            spinner.classList.add('d-none');
            
            if (data.error) {
                errorDiv.textContent = data.error;
                errorDiv.style.display = 'block';
                return;
            }
            
            displayMonteCarloResults(data.results);
            resultsDiv.style.display = 'block';
        })
        .catch(error => {
            spinner.classList.add('d-none');
            errorDiv.textContent = 'An error occurred during simulation. Please try again.';
            errorDiv.style.display = 'block';
            console.error('Error:', error);
        });
    });

    // Backtesting Form Handler
    document.getElementById('backtestingForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const spinner = document.getElementById('backtestingSpinner');
        const resultsDiv = document.getElementById('backtestingResults');
        const errorDiv = document.getElementById('backtestingError');
        
        // Show loading state
        spinner.classList.remove('d-none');
        resultsDiv.style.display = 'none';
        errorDiv.style.display = 'none';
        
        fetch('/backtesting', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            spinner.classList.add('d-none');
            
            if (data.error) {
                errorDiv.textContent = data.error;
                errorDiv.style.display = 'block';
                return;
            }
            
            displayBacktestingResults(data.results);
            resultsDiv.style.display = 'block';
        })
        .catch(error => {
            spinner.classList.add('d-none');
            errorDiv.textContent = 'An error occurred during backtesting. Please try again.';
            errorDiv.style.display = 'block';
            console.error('Error:', error);
        });
    });

    // Options Pricing Form Handler
    document.getElementById('optionsPricingForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const spinner = document.getElementById('optionsPricingSpinner');
        const resultsDiv = document.getElementById('optionsPricingResults');
        const errorDiv = document.getElementById('optionsPricingError');
        
        // Show loading state
        spinner.classList.remove('d-none');
        resultsDiv.style.display = 'none';
        errorDiv.style.display = 'none';
        
        fetch('/options_pricing', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            spinner.classList.add('d-none');
            
            if (data.error) {
                errorDiv.textContent = data.error;
                errorDiv.style.display = 'block';
                return;
            }
            
            displayOptionsPricingResults(data.results);
            resultsDiv.style.display = 'block';
        })
        .catch(error => {
            spinner.classList.add('d-none');
            errorDiv.textContent = 'An error occurred during options pricing. Please try again.';
            errorDiv.style.display = 'block';
            console.error('Error:', error);
        });
    });

    // Option Strategy Form Handler
    document.getElementById('optionStrategyForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const spinner = document.getElementById('optionStrategySpinner');
        const resultsDiv = document.getElementById('optionStrategyResults');
        const errorDiv = document.getElementById('optionsPricingError');
        
        // Show loading state
        spinner.classList.remove('d-none');
        resultsDiv.style.display = 'none';
        errorDiv.style.display = 'none';
        
        fetch('/option_strategy', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            spinner.classList.add('d-none');
            
            if (data.error) {
                errorDiv.textContent = data.error;
                errorDiv.style.display = 'block';
                return;
            }
            
            displayOptionStrategyResults(data.results);
            resultsDiv.style.display = 'block';
        })
        .catch(error => {
            spinner.classList.add('d-none');
            errorDiv.textContent = 'An error occurred during strategy analysis. Please try again.';
            errorDiv.style.display = 'block';
            console.error('Error:', error);
        });
    });

    // Strategy Type Change Handler
    document.getElementById('strategyTypeSelect').addEventListener('change', function() {
        updateStrategyStrikes(this.value);
    });

    // Initialize strategy strikes on page load
    updateStrategyStrikes('straddle');

    function updateStrategyStrikes(strategyType) {
        const strikesDiv = document.getElementById('strategyStrikes');
        
        if (strategyType === 'straddle') {
            strikesDiv.innerHTML = `
                <div class="mb-3">
                    <label class="form-label">Strike Price ($ - leave blank for ATM)</label>
                    <input type="number" class="form-control" name="strike" step="0.01" min="0.01" placeholder="At-the-money if blank">
                </div>
            `;
        } else if (strategyType === 'strangle') {
            strikesDiv.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Call Strike ($ - leave blank for 5% OTM)</label>
                            <input type="number" class="form-control" name="call_strike" step="0.01" min="0.01" placeholder="5% out-of-the-money if blank">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Put Strike ($ - leave blank for 5% OTM)</label>
                            <input type="number" class="form-control" name="put_strike" step="0.01" min="0.01" placeholder="5% out-of-the-money if blank">
                        </div>
                    </div>
                </div>
            `;
        }
    }

    function displayMonteCarloResults(results) {
        const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
        
        // Risk Metrics
        document.getElementById('riskMetrics').innerHTML = `
            <div class="metrics-grid">
                <div class="metric-item">
                    <div class="metric-label">Value at Risk (5%)</div>
                    <div class="metric-value negative-change">${results.var_5.toFixed(2)}%</div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">Expected Shortfall</div>
                    <div class="metric-value negative-change">${results.expected_shortfall.toFixed(2)}%</div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">Annual Volatility</div>
                    <div class="metric-value">${results.annual_volatility.toFixed(2)}%</div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">Risk Level</div>
                    <div class="metric-value">${results.risk_level}</div>
                </div>
            </div>
        `;
        
        // Price Scenarios
        document.getElementById('priceScenarios').innerHTML = `
            <div class="table-responsive">
                <table class="table table-sm table-dark">
                    <thead>
                        <tr>
                            <th>Scenario</th>
                            <th>Price</th>
                            <th>P&L</th>
                            <th>Return</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${Object.entries(results.scenarios).map(([percentile, scenario]) => `
                            <tr>
                                <td>${percentile} Percentile</td>
                                <td>$${scenario.price.toFixed(2)}</td>
                                <td class="${scenario.profit_loss > 0 ? 'positive-change' : 'negative-change'}">
                                    $${scenario.profit_loss.toFixed(0)}
                                </td>
                                <td class="${scenario.return_percentage > 0 ? 'positive-change' : 'negative-change'}">
                                    ${scenario.return_percentage.toFixed(1)}%
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        `;
        
        // Recommendations
        document.getElementById('riskRecommendations').innerHTML = `
            <div class="alert alert-info">
                ${results.recommendation.map(rec => `<div>â€¢ ${rec}</div>`).join('')}
            </div>
        `;
        
        // Chart
        const traces = [];
        for (let i = 0; i < Math.min(results.sample_paths.length, 20); i++) {
            traces.push({
                x: results.dates,
                y: results.sample_paths[i],
                type: 'scatter',
                mode: 'lines',
                line: { width: 1, color: 'rgba(100, 150, 200, 0.3)' },
                showlegend: false
            });
        }
        
        // Add current price line
        traces.push({
            x: [results.dates[0], results.dates[results.dates.length - 1]],
            y: [results.current_price, results.current_price],
            type: 'scatter',
            mode: 'lines',
            line: { width: 2, color: 'red', dash: 'dash' },
            name: 'Current Price'
        });
        
        const layout = {
            title: `Monte Carlo Simulation - ${results.symbol}`,
            paper_bgcolor: 'transparent',
            plot_bgcolor: 'transparent',
            font: { color: isDark ? '#e0e0e0' : '#1a202c' },
            xaxis: { 
                title: 'Date',
                gridcolor: isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)'
            },
            yaxis: { 
                title: 'Price ($)',
                gridcolor: isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)'
            },
            showlegend: true,
            legend: { x: 0, y: 1 }
        };
        
        Plotly.newPlot('monteCarloChart', traces, layout);
    }

    function displayBacktestingResults(results) {
        const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
        
        // Performance Metrics
        document.getElementById('performanceMetrics').innerHTML = `
            <div class="metrics-grid">
                <div class="metric-item">
                    <div class="metric-label">Total Return</div>
                    <div class="metric-value ${results.performance.total_return > 0 ? 'positive-change' : 'negative-change'}">
                        ${results.performance.total_return.toFixed(2)}%
                    </div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">Sharpe Ratio</div>
                    <div class="metric-value">${results.performance.sharpe_ratio.toFixed(3)}</div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">Max Drawdown</div>
                    <div class="metric-value negative-change">${results.performance.max_drawdown.toFixed(2)}%</div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">Win Rate</div>
                    <div class="metric-value">${results.performance.win_rate.toFixed(1)}%</div>
                </div>
            </div>
        `;
        
        // Statistics
        document.getElementById('backtestingStats').innerHTML = `
            <div class="metrics-grid">
                <div class="metric-item">
                    <div class="metric-label">Final Value</div>
                    <div class="metric-value">$${results.final_portfolio_value.toFixed(0)}</div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">Total Trades</div>
                    <div class="metric-value">${results.total_trades}</div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">vs Benchmark</div>
                    <div class="metric-value ${results.outperformance > 0 ? 'positive-change' : 'negative-change'}">
                        ${results.outperformance > 0 ? '+' : ''}${results.outperformance.toFixed(2)}%
                    </div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">Volatility</div>
                    <div class="metric-value">${results.performance.volatility.toFixed(2)}%</div>
                </div>
            </div>
        `;
        
        // Recent Trades
        if (results.trades && results.trades.length > 0) {
            document.getElementById('recentTrades').innerHTML = `
                <div class="table-responsive">
                    <table class="table table-sm table-dark">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Action</th>
                                <th>Shares</th>
                                <th>Price</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${results.trades.slice(-5).map(trade => `
                                <tr>
                                    <td>${new Date(trade.date).toLocaleDateString()}</td>
                                    <td><span class="badge bg-${trade.action === 'BUY' ? 'success' : 'danger'}">${trade.action}</span></td>
                                    <td>${trade.shares}</td>
                                    <td>$${trade.price.toFixed(2)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        // Equity Curve Chart
        const strategyTrace = {
            x: results.dates,
            y: results.strategy_equity_curve,
            name: `${results.strategy.replace('_', ' ').toUpperCase()}`,
            type: 'scatter',
            line: { width: 2, color: '#00ff88' }
        };
        
        const benchmarkTrace = {
            x: results.dates,
            y: results.benchmark_equity_curve,
            name: 'Buy & Hold',
            type: 'scatter',
            line: { width: 2, color: '#ff6b6b' }
        };
        
        const layout = {
            title: `Strategy Performance - ${results.symbol}`,
            paper_bgcolor: 'transparent',
            plot_bgcolor: 'transparent',
            font: { color: isDark ? '#e0e0e0' : '#1a202c' },
            xaxis: { 
                title: 'Date',
                gridcolor: isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)'
            },
            yaxis: { 
                title: 'Portfolio Value ($)',
                gridcolor: isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)'
            },
            showlegend: true,
            legend: { x: 0, y: 1 }
        };
        
        Plotly.newPlot('backtestingChart', [strategyTrace, benchmarkTrace], layout);
    }

    function displayOptionsPricingResults(results) {
        // Option Pricing
        document.getElementById('optionPricing').innerHTML = `
            <div class="metrics-grid">
                <div class="metric-item">
                    <div class="metric-label">Option Price</div>
                    <div class="metric-value">$${results.option_price.toFixed(3)}</div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">Intrinsic Value</div>
                    <div class="metric-value">$${results.intrinsic_value.toFixed(3)}</div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">Time Value</div>
                    <div class="metric-value">$${results.time_value.toFixed(3)}</div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">Breakeven</div>
                    <div class="metric-value">$${results.breakeven.toFixed(2)}</div>
                </div>
            </div>
        `;
        
        // Greeks
        document.getElementById('optionGreeks').innerHTML = `
            <div class="metrics-grid">
                <div class="metric-item">
                    <div class="metric-label">Delta</div>
                    <div class="metric-value">${results.greeks.delta.toFixed(4)}</div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">Gamma</div>
                    <div class="metric-value">${results.greeks.gamma.toFixed(4)}</div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">Theta</div>
                    <div class="metric-value negative-change">${results.greeks.theta.toFixed(4)}</div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">Vega</div>
                    <div class="metric-value">${results.greeks.vega.toFixed(4)}</div>
                </div>
            </div>
        `;
        
        // Risk Analysis
        document.getElementById('optionRiskAnalysis').innerHTML = `
            <div class="row">
                <div class="col-md-6">
                    <div class="metric-item">
                        <div class="metric-label">ITM Probability</div>
                        <div class="metric-value">${results.itm_probability.toFixed(1)}%</div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="metric-item">
                        <div class="metric-label">Moneyness</div>
                        <div class="metric-value">${results.moneyness.toFixed(3)}</div>
                    </div>
                </div>
            </div>
            <div class="mt-2">
                <small class="text-muted">
                    <strong>Current Price:</strong> $${results.current_price.toFixed(2)} | 
                    <strong>Volatility:</strong> ${results.volatility.toFixed(1)}% | 
                    <strong>Time to Expiry:</strong> ${results.expiration_days} days
                </small>
            </div>
        `;
    }

    function displayOptionStrategyResults(results) {
        document.getElementById('strategyAnalysis').innerHTML = `
            <div class="alert alert-info">
                <h6>${results.strategy} Analysis</h6>
                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="metrics-grid">
                            <div class="metric-item">
                                <div class="metric-label">Total Cost</div>
                                <div class="metric-value negative-change">$${results.total_cost.toFixed(2)}</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-label">Max Loss</div>
                                <div class="metric-value negative-change">$${results.max_loss.toFixed(2)}</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-label">Max Profit</div>
                                <div class="metric-value">${results.max_profit}</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="metrics-grid">
                            <div class="metric-item">
                                <div class="metric-label">Upper Breakeven</div>
                                <div class="metric-value">$${results.breakeven_upper.toFixed(2)}</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-label">Lower Breakeven</div>
                                <div class="metric-value">$${results.breakeven_lower.toFixed(2)}</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-3">
                    <div><strong>Best Scenario:</strong> ${results.best_scenario}</div>
                    <div><strong>Worst Scenario:</strong> ${results.worst_scenario}</div>
                </div>
            </div>
        `;
    }
    </script>
</body>
</html>