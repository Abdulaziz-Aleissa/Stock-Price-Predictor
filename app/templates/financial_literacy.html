<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Literacy - Stock Price Predictor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Market Selection Modal */
        .market-selector {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .selector-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            max-width: 600px;
            width: 90%;
        }

        .market-options {
            display: flex;
            gap: 20px;
            margin-top: 30px;
            justify-content: center;
        }

        .market-option {
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 30px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 180px;
        }

        .market-option:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        }

        .market-flag {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .market-name {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .market-desc {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Main Content */
        .financial-content {
            display: none;
        }

        .financial-content.active {
            display: block;
        }

        .hero-section {
            text-align: center;
            padding: 60px 0;
            background: var(--accent);
            border-radius: 20px;
            margin-bottom: 40px;
            color: white;
        }

        .hero-title {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .hero-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .market-indicator {
            display: inline-block;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            font-weight: 600;
            margin-top: 20px;
        }

        /* Cards */
        .concept-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .concept-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        }

        .concept-card.expanded {
            border-color: var(--accent);
        }

        .concept-header {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .concept-content {
            display: none;
            margin-top: 20px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .concept-content.show {
            display: block;
        }

        /* Learning Level Cards */
        .level-card {
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        .level-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent) 0%, var(--accent-light) 100%);
            transition: all 0.3s ease;
        }

        .beginner-level:before { background: linear-gradient(90deg, #28a745, #34ce57); }
        .intermediate-level:before { background: linear-gradient(90deg, #ffc107, #ffcd39); }
        .advanced-level:before { background: linear-gradient(90deg, #dc3545, #e9606f); }

        .level-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            border-color: var(--accent);
        }

        .level-card.active {
            border-color: var(--accent);
            background: rgba(52, 144, 220, 0.1);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(52, 144, 220, 0.2);
        }

        .level-header {
            margin-bottom: 20px;
        }

        .level-header i {
            font-size: 2.5rem;
            color: var(--accent);
            margin-bottom: 15px;
            display: block;
        }

        .beginner-level .level-header i { color: #28a745; }
        .intermediate-level .level-header i { color: #ffc107; }
        .advanced-level .level-header i { color: #dc3545; }

        .level-header h4 {
            color: var(--text-primary);
            font-weight: 600;
            margin: 0;
        }

        .level-card p {
            color: var(--text-secondary);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .level-progress {
            margin-top: auto;
        }

        /* Level Content Areas */
        .level-content {
            display: none;
        }

        .level-content.active {
            display: block;
        }

        .concept-section {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            margin-bottom: 20px;
            padding: 25px;
        }

        .concept-section h5 {
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .concept-section h5 i {
            margin-right: 10px;
            color: var(--accent);
        }

        .concept-list {
            list-style: none;
            padding: 0;
        }

        .concept-list li {
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .concept-list li:last-child {
            border-bottom: none;
        }

        .concept-list li strong {
            color: var(--text-primary);
        }

        .resource-links {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .resource-link {
            display: inline-flex;
            align-items: center;
            padding: 8px 15px;
            background: var(--accent);
            color: white;
            text-decoration: none;
            border-radius: 20px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .resource-link:hover {
            background: var(--accent-dark);
            color: white;
            transform: translateY(-1px);
        }

        .resource-link i {
            margin-right: 5px;
        }

        /* Calculator Cards */
        .calculator-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .calculator-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .calculator-inputs {
            flex: 1;
        }
        
        .calculator-actions {
            margin-top: auto;
            padding-top: 20px;
        }

        /* Financial Advisor Bot */
        .advisor-bot {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 30px;
            margin-top: 40px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .advisor-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .advisor-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--accent), #00d4aa);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .advisor-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .advisor-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin: 0;
        }

        .chat-container {
            height: 400px;
            border: 1px solid var(--border-color);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--input-bg);
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .chat-message {
            max-width: 80%;
            padding: 12px 18px;
            border-radius: 18px;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .message-bot {
            align-self: flex-start;
            background: var(--accent);
            color: white;
            border-bottom-left-radius: 6px;
        }

        .message-user {
            align-self: flex-end;
            background: var(--card-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-bottom-right-radius: 6px;
        }

        .chat-input-container {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            background: var(--card-bg);
        }

        .chat-input-group {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 25px;
            padding: 12px 20px;
            resize: none;
            font-family: inherit;
            max-height: 100px;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 0.2rem rgba(66, 153, 225, 0.25);
        }

        .chat-send-btn {
            background: var(--accent);
            border: none;
            color: white;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .chat-send-btn:hover {
            background: #0e7490;
            transform: scale(1.05);
        }

        .chat-send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            font-style: italic;
            padding: 10px 18px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--text-secondary);
            border-radius: 50%;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typingAnimation {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        .quick-questions {
            margin-top: 20px;
        }

        .quick-question-btn {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            margin: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .quick-question-btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .calculator-header {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-control {
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 15px;
        }

        .form-control:focus {
            background: var(--input-bg);
            border-color: var(--accent);
            color: var(--text-primary);
            box-shadow: 0 0 0 0.2rem rgba(66, 153, 225, 0.25);
        }

        .btn-calculate {
            background: var(--accent);
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn-calculate:hover {
            background: var(--button-hover);
            transform: translateY(-1px);
        }

        .result-box {
            margin-top: 20px;
            padding: 20px;
            background: rgba(66, 153, 225, 0.1);
            border: 1px solid var(--accent);
            border-radius: 8px;
            color: var(--text-primary);
            display: none;
        }

        .result-value {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--accent);
        }

        .result-details {
            line-height: 1.5;
            color: var(--text-secondary);
        }

        /* Video Cards */
        .video-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .video-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
            border-color: var(--accent);
        }

        .video-thumbnail {
            background: var(--accent);
            height: 120px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            color: white;
            font-size: 2rem;
        }

        .video-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .video-duration {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Currency Switcher */
        .currency-switcher {
            position: fixed;
            top: 80px;
            left: 20px;
            z-index: 1000;
            display: flex;
            gap: 5px;
        }

        .currency-btn {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 15px;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .currency-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .currency-btn:hover {
            transform: translateY(-1px);
        }

        /* Navigation */
        .nav-links {
            text-align: center;
            margin-bottom: 30px;
        }

        .nav-links .btn {
            margin: 0 10px 10px 0;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .market-options {
                flex-direction: column;
                gap: 15px;
            }
            
            .hero-title {
                font-size: 2rem;
            }
            
            .currency-switcher {
                position: static;
                justify-content: center;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Theme Switch -->
    <div class="theme-switch">
        <div class="switch-track">
            <div class="switch-icons">
                <div class="sun">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
                </div>
                <div class="moon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                </div>
            </div>
            <div class="switch-circle"></div>
        </div>
    </div>

    <!-- Currency Switcher -->
    <div class="currency-switcher">
        <div class="currency-btn active" id="sarBtn" onclick="switchCurrency('SAR')">SAR</div>
        <div class="currency-btn" id="usdBtn" onclick="switchCurrency('USD')">USD</div>
    </div>

    <!-- Market Selection Modal -->
    <div class="market-selector" id="marketSelector">
        <div class="selector-card">
            <h2 style="color: var(--text-primary); margin-bottom: 20px;">
                <i class="fas fa-globe"></i> Choose Your Market
            </h2>
            <p style="color: var(--text-secondary); margin-bottom: 30px;">
                Select your preferred market to get localized financial education content
            </p>
            <div class="market-options">
                <div class="market-option" onclick="selectMarket('saudi')">
                    <div class="market-flag">🇸🇦</div>
                    <div class="market-name">Saudi Arabia</div>
                    <div class="market-desc">Tadawul, SAR currency, local investment options</div>
                </div>
                <div class="market-option" onclick="selectMarket('us')">
                    <div class="market-flag">🇺🇸</div>
                    <div class="market-name">United States</div>
                    <div class="market-desc">NYSE, NASDAQ, USD currency, 401k & IRA</div>
                </div>
            </div>
        </div>
    </div>

    <div class="content-box">
        <!-- Main Content (Hidden until market selected) -->
        <div class="financial-content" id="financialContent">
            <!-- Navigation -->
            <div class="nav-links">
                <a href="{{ url_for('index') }}" class="btn btn-custom">
                    <i class="fas fa-home"></i> Home
                </a>
                {% if current_user.is_authenticated %}
                <a href="{{ url_for('dashboard') }}" class="btn btn-custom">
                    <i class="fas fa-chart-line"></i> Dashboard
                </a>
                {% endif %}
            </div>

            <!-- Hero Section -->
            <div class="hero-section">
                <h1 class="hero-title">
                    <i class="fas fa-graduation-cap"></i> Financial Literacy Center
                </h1>
                <p class="hero-subtitle">Master the fundamentals of investing and financial planning</p>
                <div class="market-indicator" id="marketIndicator">
                    <i class="fas fa-map-marker-alt"></i> <span id="currentMarket">Loading...</span>
                </div>
            </div>

            <!-- Educational Videos Section -->
            <div class="mb-5">
                <h2 class="mb-4" style="color: var(--text-primary);">
                    <i class="fas fa-play-circle"></i> Educational Videos
                </h2>
                <div class="row" id="videoGrid">
                    <!-- Videos will be populated by JavaScript -->
                </div>
            </div>

            <!-- Financial Concepts Section -->
            <div class="mb-5">
                <h2 class="mb-4" style="color: var(--text-primary);">
                    <i class="fas fa-graduation-cap"></i> Financial Education Center
                </h2>
                
                <!-- Learning Levels -->
                <div class="row mb-4">
                    <div class="col-md-4 mb-3">
                        <div class="level-card beginner-level" onclick="showLevel('beginner')">
                            <div class="level-header">
                                <i class="fas fa-seedling"></i>
                                <h4>Beginner</h4>
                            </div>
                            <p>Start your investment journey with basic concepts and fundamental principles</p>
                            <div class="level-progress">
                                <span class="badge bg-success">Foundation Level</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="level-card intermediate-level" onclick="showLevel('intermediate')">
                            <div class="level-header">
                                <i class="fas fa-chart-line"></i>
                                <h4>Intermediate</h4>
                            </div>
                            <p>Build on basics with advanced strategies and market analysis techniques</p>
                            <div class="level-progress">
                                <span class="badge bg-warning">Growth Level</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="level-card advanced-level" onclick="showLevel('advanced')">
                            <div class="level-header">
                                <i class="fas fa-trophy"></i>
                                <h4>Advanced</h4>
                            </div>
                            <p>Master complex investment strategies and professional-level techniques</p>
                            <div class="level-progress">
                                <span class="badge bg-danger">Expert Level</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Content Areas for Each Level -->
                <div id="levelContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>

            <!-- Interactive Calculators Section -->
            <div class="mb-5">
                <h2 class="mb-4" style="color: var(--text-primary);">
                    <i class="fas fa-calculator"></i> Financial Calculators
                </h2>
                <div class="row">
                    <!-- Compound Interest Calculator -->
                    <div class="col-lg-6 col-md-12 mb-4">
                        <div class="calculator-card">
                            <div class="calculator-content">
                                <div class="calculator-header">
                                    <i class="fas fa-chart-line"></i> Compound Interest Calculator
                                </div>
                                <div class="calculator-inputs">
                                    <div class="mb-3">
                                        <label class="form-label">Initial Investment</label>
                                        <input type="number" class="form-control" id="principal" value="10000" placeholder="Enter amount">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Monthly Contribution</label>
                                        <input type="number" class="form-control" id="monthly" value="500" placeholder="Monthly addition">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Annual Interest Rate (%)</label>
                                        <input type="number" class="form-control" id="rate" value="7" step="0.1" placeholder="Expected return">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Investment Period (Years)</label>
                                        <input type="number" class="form-control" id="years" value="30" placeholder="Time horizon">
                                    </div>
                                </div>
                                <div class="calculator-actions">
                                    <button class="btn-calculate" onclick="calculateCompound()">
                                        <i class="fas fa-calculator"></i> Calculate Growth
                                    </button>
                                    <div id="compoundResult" class="result-box">
                                        <div class="result-value"></div>
                                        <div class="result-details"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- P/E Ratio Calculator -->
                    <div class="col-lg-6 col-md-12 mb-4">
                        <div class="calculator-card">
                            <div class="calculator-content">
                                <div class="calculator-header">
                                    <i class="fas fa-balance-scale"></i> P/E Ratio Calculator
                                </div>
                                <div class="calculator-inputs">
                                    <div class="mb-3">
                                        <label class="form-label">Stock Price</label>
                                        <input type="number" class="form-control" id="stockPrice" value="100" placeholder="Current price">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Earnings Per Share</label>
                                        <input type="number" class="form-control" id="eps" value="5" step="0.01" placeholder="Annual EPS">
                                    </div>
                                </div>
                                <div class="calculator-actions">
                                    <button class="btn-calculate" onclick="calculatePE()">
                                        <i class="fas fa-chart-bar"></i> Analyze Valuation
                                    </button>
                                    <div id="peResult" class="result-box">
                                        <div class="result-value"></div>
                                        <div class="result-details"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Emergency Fund Calculator -->
                    <div class="col-lg-6 col-md-12 mb-4">
                        <div class="calculator-card">
                            <div class="calculator-content">
                                <div class="calculator-header">
                                    <i class="fas fa-shield-alt"></i> Emergency Fund Calculator
                                </div>
                                <div class="calculator-inputs">
                                    <div class="mb-3">
                                        <label class="form-label">Monthly Expenses</label>
                                        <input type="number" class="form-control" id="monthlyExpenses" value="4000" placeholder="Total monthly costs">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Job Stability</label>
                                        <select class="form-control" id="jobStability">
                                            <option value="3">Stable job (3 months)</option>
                                            <option value="6">Moderate stability (6 months)</option>
                                            <option value="12">Unstable job (12 months)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="calculator-actions">
                                    <button class="btn-calculate" onclick="calculateEmergencyFund()">
                                        <i class="fas fa-shield-alt"></i> Calculate Fund
                                    </button>
                                    <div id="emergencyResult" class="result-box">
                                        <div class="result-value"></div>
                                        <div class="result-details"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Retirement Calculator -->
                    <div class="col-lg-6 col-md-12 mb-4">
                        <div class="calculator-card">
                            <div class="calculator-content">
                                <div class="calculator-header">
                                    <i class="fas fa-piggy-bank"></i> Retirement Calculator
                                </div>
                                <div class="calculator-inputs">
                                    <div class="mb-3">
                                        <label class="form-label">Current Age</label>
                                        <input type="number" class="form-control" id="currentAge" value="30" placeholder="Your current age">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Retirement Age</label>
                                        <input type="number" class="form-control" id="retirementAge" value="65" placeholder="Desired retirement age">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Monthly Savings</label>
                                        <input type="number" class="form-control" id="monthlySavings" value="1000" placeholder="Monthly contribution">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Expected Annual Return (%)</label>
                                        <input type="number" class="form-control" id="returnRate" value="7" step="0.1" placeholder="Expected return">
                                    </div>
                                </div>
                                <div class="calculator-actions">
                                    <button class="btn-calculate" onclick="calculateRetirement()">
                                        <i class="fas fa-chart-pie"></i> Plan Retirement
                                    </button>
                                    <div id="retirementResult" class="result-box">
                                        <div class="result-value"></div>
                                        <div class="result-details"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- What If Investment Calculator -->
                    <div class="col-lg-6 col-md-12 mb-4">
                        <div class="calculator-card">
                            <div class="calculator-content">
                                <div class="calculator-header">
                                    <i class="fas fa-lightbulb"></i> What If Investment Calculator
                                </div>
                                <div class="calculator-inputs">
                                    <div class="mb-3">
                                        <label class="form-label">Instead of buying...</label>
                                        <select class="form-control" id="purchaseType">
                                            <option value="flagship_phone">Latest Flagship Phone (ر.س 4,500)</option>
                                            <option value="luxury_watch">Luxury Watch (ر.س 15,000)</option>
                                            <option value="designer_bag">Designer Bag (ر.س 8,000)</option>
                                            <option value="gaming_setup">Gaming Setup (ر.س 12,000)</option>
                                            <option value="vacation">Luxury Vacation (ر.س 20,000)</option>
                                            <option value="custom">Custom Amount</option>
                                        </select>
                                    </div>
                                    <div class="mb-3" id="customAmountDiv" style="display: none;">
                                        <label class="form-label">Custom Amount</label>
                                        <input type="number" class="form-control" id="customAmount" placeholder="Enter custom amount">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Investment Date</label>
                                        <select class="form-control" id="investmentDate">
                                            <option value="1">1 year ago</option>
                                            <option value="2">2 years ago</option>
                                            <option value="3">3 years ago</option>
                                            <option value="5">5 years ago</option>
                                            <option value="10">10 years ago</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Stock/Investment</label>
                                        <select class="form-control" id="stockChoice">
                                            <option value="sabic">SABIC (2010) - 8% Annual Return</option>
                                            <option value="aramco">Saudi Aramco (2380) - 12% Annual Return</option>
                                            <option value="rajhi">Al Rajhi Bank (1120) - 10% Annual Return</option>
                                            <option value="snb">Saudi National Bank (1180) - 9% Annual Return</option>
                                            <option value="sp500">S&P 500 Index - 10% Annual Return</option>
                                            <option value="tesla">Tesla (TSLA) - 25% Annual Return</option>
                                            <option value="apple">Apple (AAPL) - 15% Annual Return</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="calculator-actions">
                                    <button class="btn-calculate" onclick="calculateWhatIf()">
                                        <i class="fas fa-magic"></i> See What Could Have Been
                                    </button>
                                    <div id="whatIfResult" class="result-box">
                                        <div class="result-value"></div>
                                        <div class="result-details"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Rent vs Buy Calculator -->
                    <div class="col-lg-6 col-md-12 mb-4">
                        <div class="calculator-card">
                            <div class="calculator-content">
                                <div class="calculator-header">
                                    <i class="fas fa-home"></i> Rent vs Buy Decision Calculator
                                </div>
                                <div class="calculator-inputs">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <h6 style="color: var(--text-primary); margin-bottom: 15px;">
                                                <i class="fas fa-key"></i> Renting Option
                                            </h6>
                                            <div class="mb-3">
                                                <label class="form-label">Monthly Rent</label>
                                                <input type="number" class="form-control" id="monthlyRent" value="3000" placeholder="Monthly rent">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Annual Rent Increase (%)</label>
                                                <input type="number" class="form-control" id="rentIncrease" value="3" step="0.1" placeholder="Yearly increase">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <h6 style="color: var(--text-primary); margin-bottom: 15px;">
                                                <i class="fas fa-home"></i> Buying Option
                                            </h6>
                                            <div class="mb-3">
                                                <label class="form-label">Home Price</label>
                                                <input type="number" class="form-control" id="homePrice" value="800000" placeholder="Purchase price">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Down Payment (%)</label>
                                                <input type="number" class="form-control" id="downPayment" value="20" placeholder="Down payment %">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Mortgage Rate (%)</label>
                                                <input type="number" class="form-control" id="mortgageRate" value="4.5" step="0.1" placeholder="Interest rate">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Time Period (Years)</label>
                                        <input type="number" class="form-control" id="timePeriod" value="10" placeholder="Analysis period">
                                    </div>
                                </div>
                                <div class="calculator-actions">
                                    <button class="btn-calculate" onclick="calculateRentVsBuy()">
                                        <i class="fas fa-balance-scale"></i> Compare Options
                                    </button>
                                    <div id="rentBuyResult" class="result-box">
                                        <div class="result-value"></div>
                                        <div class="result-details"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Financial Advisor Bot Section -->
            <div class="advisor-bot">
                <div class="advisor-header">
                    <div class="advisor-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div>
                        <h3 class="advisor-title">Financial Advisor Assistant</h3>
                        <p class="advisor-subtitle">Ask me anything about investing, financial planning, and market strategies</p>
                    </div>
                </div>

                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">
                        <div class="chat-message message-bot">
                            <div>Hi! I'm your AI Financial Advisor. I can help you understand investments, calculate returns, explain financial concepts, and provide guidance on financial planning. What would you like to know?</div>
                        </div>
                    </div>
                    
                    <div class="chat-input-container">
                        <div class="chat-input-group">
                            <textarea class="chat-input" id="chatInput" placeholder="Ask me about investing, taxes, retirement planning..." rows="1"></textarea>
                            <button class="chat-send-btn" id="sendBtn" onclick="sendMessage()">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="quick-questions">
                    <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 10px;">Quick questions:</p>
                    <button class="quick-question-btn" onclick="askQuickQuestion('How do I start investing?')">
                        How do I start investing?
                    </button>
                    <button class="quick-question-btn" onclick="askQuickQuestion('What is diversification?')">
                        What is diversification?
                    </button>
                    <button class="quick-question-btn" onclick="askQuickQuestion('How much should I save for retirement?')">
                        How much should I save for retirement?
                    </button>
                    <button class="quick-question-btn" onclick="askQuickQuestion('What are the best investment accounts?')">
                        What are the best investment accounts?
                    </button>
                    <button class="quick-question-btn" onclick="askQuickQuestion('How do I calculate compound interest?')">
                        How do I calculate compound interest?
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
    <script>
        // Global variables
        let currentMarket = 'saudi';
        let currentCurrency = 'SAR';

        // Market data
        const marketData = {
            saudi: {
                name: 'Saudi Arabia 🇸🇦',
                currency: 'SAR',
                symbol: 'ر.س',
                videos: [
                    { 
                        title: 'Tadawul Trading Basics', 
                        duration: '15:30', 
                        icon: 'chart-line',
                        description: 'Learn the fundamentals of trading on the Saudi stock exchange',
                        content: `
                            <h5>Tadawul Trading Fundamentals</h5>
                            <p><strong>What is Tadawul?</strong></p>
                            <p>Tadawul is the only stock exchange in Saudi Arabia, established in 2007. It's one of the largest stock markets in the Middle East.</p>
                            
                            <p><strong>Trading Hours:</strong></p>
                            <ul>
                                <li>Sunday to Thursday: 10:00 AM - 3:00 PM (Saudi time)</li>
                                <li>Pre-market session: 9:30 AM - 10:00 AM</li>
                                <li>Post-market session: 3:00 PM - 3:10 PM</li>
                            </ul>
                            
                            <p><strong>Key Features:</strong></p>
                            <ul>
                                <li>Over 200 listed companies across various sectors</li>
                                <li>Market cap exceeding $2.5 trillion SAR</li>
                                <li>Supports both individual and institutional investors</li>
                                <li>Follows Islamic (Sharia) compliance principles</li>
                            </ul>
                            
                            <p><strong>How to Start Trading:</strong></p>
                            <ol>
                                <li>Open a trading account with a licensed broker</li>
                                <li>Complete KYC (Know Your Customer) requirements</li>
                                <li>Fund your account</li>
                                <li>Use the broker's platform to place trades</li>
                            </ol>
                        `
                    },
                    { 
                        title: 'Islamic Investment Principles', 
                        duration: '12:45', 
                        icon: 'mosque',
                        description: 'Understanding Sharia-compliant investing fundamentals',
                        content: `
                            <h5>Islamic Investment Principles</h5>
                            <p><strong>Core Principles of Islamic Finance:</strong></p>
                            
                            <p><strong>1. Prohibition of Riba (Interest):</strong></p>
                            <ul>
                                <li>No predetermined interest rates</li>
                                <li>Profit-sharing arrangements instead</li>
                                <li>Investment must involve real economic activity</li>
                            </ul>
                            
                            <p><strong>2. Prohibition of Gharar (Excessive Uncertainty):</strong></p>
                            <ul>
                                <li>Contracts must be clear and unambiguous</li>
                                <li>No speculation or gambling-like activities</li>
                                <li>Transparency in all transactions</li>
                            </ul>
                            
                            <p><strong>3. Prohibition of Haram Activities:</strong></p>
                            <ul>
                                <li>No investment in alcohol, gambling, or pork-related businesses</li>
                                <li>No conventional banking or insurance companies</li>
                                <li>Tobacco and weapons manufacturing excluded</li>
                            </ul>
                            
                            <p><strong>Sharia-Compliant Investment Options:</strong></p>
                            <ul>
                                <li>Islamic stocks (screened companies)</li>
                                <li>Sukuk (Islamic bonds)</li>
                                <li>Islamic mutual funds</li>
                                <li>Real estate investments</li>
                                <li>Commodity trading</li>
                            </ul>
                        `
                    },
                    { 
                        title: 'Vision 2030 Investment Opportunities', 
                        duration: '18:20', 
                        icon: 'rocket',
                        description: 'Explore investment opportunities in Saudi Vision 2030 sectors',
                        content: `
                            <h5>Vision 2030 Investment Opportunities</h5>
                            
                            <p><strong>What is Vision 2030?</strong></p>
                            <p>Saudi Vision 2030 is a strategic framework to reduce Saudi Arabia's dependence on oil and develop public service sectors such as health, education, infrastructure, recreation, and tourism.</p>
                            
                            <p><strong>Key Investment Sectors:</strong></p>
                            
                            <p><strong>1. NEOM & Mega Projects:</strong></p>
                            <ul>
                                <li>The Line: $500 billion linear city project</li>
                                <li>Red Sea Project: Luxury tourism destination</li>
                                <li>Qiddiya: Entertainment and sports hub</li>
                            </ul>
                            
                            <p><strong>2. Renewable Energy:</strong></p>
                            <ul>
                                <li>50% renewable energy target by 2030</li>
                                <li>Solar and wind power projects</li>
                                <li>Green hydrogen production</li>
                            </ul>
                            
                            <p><strong>3. Tourism & Entertainment:</strong></p>
                            <ul>
                                <li>Opening to international tourism</li>
                                <li>Entertainment venues and theme parks</li>
                                <li>Cultural and heritage site development</li>
                            </ul>
                            
                            <p><strong>4. Technology & Innovation:</strong></p>
                            <ul>
                                <li>Digital transformation initiatives</li>
                                <li>Fintech and e-commerce growth</li>
                                <li>Artificial intelligence development</li>
                            </ul>
                            
                            <p><strong>Investment Opportunities:</strong></p>
                            <ul>
                                <li>Public Investment Fund (PIF) backed companies</li>
                                <li>IPOs of state-owned enterprises</li>
                                <li>Private equity in growing sectors</li>
                                <li>Real estate in development zones</li>
                            </ul>
                        `
                    },
                    { 
                        title: 'GOSI Retirement Planning', 
                        duration: '14:15', 
                        icon: 'calendar-alt',
                        description: 'Understanding Saudi social security and retirement benefits',
                        content: `
                            <h5>GOSI Retirement Planning Guide</h5>
                            
                            <p><strong>What is GOSI?</strong></p>
                            <p>The General Organization for Social Insurance (GOSI) provides social insurance coverage for Saudi and expatriate workers in the private sector.</p>
                            
                            <p><strong>Retirement Benefits:</strong></p>
                            
                            <p><strong>1. Old-Age Pension:</strong></p>
                            <ul>
                                <li>Available at age 60 for men, 55 for women</li>
                                <li>Minimum 120 months of contributions required</li>
                                <li>Pension = 2.5% × number of years × average salary of best 24 months</li>
                            </ul>
                            
                            <p><strong>2. Early Retirement:</strong></p>
                            <ul>
                                <li>Available 5 years before normal retirement age</li>
                                <li>Reduced pension calculation</li>
                                <li>Minimum 300 months of contributions</li>
                            </ul>
                            
                            <p><strong>Contribution Rates (Private Sector):</strong></p>
                            <ul>
                                <li>Employee: 10% of salary</li>
                                <li>Employer: 12% of salary</li>
                                <li>Total: 22% going to retirement fund</li>
                            </ul>
                            
                            <p><strong>Additional Retirement Planning:</strong></p>
                            <ul>
                                <li>Consider supplementary private pensions</li>
                                <li>Build emergency fund (6-12 months expenses)</li>
                                <li>Invest in Sharia-compliant instruments</li>
                                <li>Plan for healthcare costs in retirement</li>
                            </ul>
                            
                            <p><strong>Tips for Better Retirement:</strong></p>
                            <ul>
                                <li>Start saving early to benefit from compound growth</li>
                                <li>Regularly review and update your retirement plan</li>
                                <li>Consider inflation when planning retirement needs</li>
                                <li>Diversify investments beyond GOSI benefits</li>
                            </ul>
                        `
                    }
                ],
                educationLevels: {
                    beginner: {
                        title: 'Beginner Level',
                        description: 'Master the fundamentals of investing and financial planning',
                        sections: [
                            {
                                title: 'Understanding Money & Banking',
                                icon: 'coins',
                                concepts: [
                                    'What is money and how does it work?',
                                    'Saudi banking system and Islamic banking principles',
                                    'Types of bank accounts (checking, savings, investment)',
                                    'Understanding interest (riba) vs profit sharing in Islamic finance',
                                    'How to read bank statements and manage accounts'
                                ],
                                conceptExplanations: [
                                    {
                                        title: 'What is money and how does it work?',
                                        content: `
                                            <h5>Understanding Money in Saudi Arabia</h5>
                                            
                                            <p><strong>What is Money?</strong></p>
                                            <p>Money is a medium of exchange that facilitates trade and commerce. In Saudi Arabia, the Saudi Riyal (SAR) serves as the official currency, pegged to the US Dollar at approximately 3.75 SAR per USD.</p>
                                            
                                            <p><strong>Functions of Money:</strong></p>
                                            <ul>
                                                <li><strong>Medium of Exchange:</strong> Facilitates buying and selling goods and services</li>
                                                <li><strong>Store of Value:</strong> Maintains purchasing power over time</li>
                                                <li><strong>Unit of Account:</strong> Provides a standard measure for pricing</li>
                                            </ul>
                                            
                                            <p><strong>Saudi Arabian Monetary Authority (SAMA):</strong></p>
                                            <ul>
                                                <li>Central bank responsible for monetary policy</li>
                                                <li>Maintains currency peg to USD for stability</li>
                                                <li>Regulates banks and financial institutions</li>
                                                <li>Ensures compliance with Islamic banking principles</li>
                                            </ul>
                                            
                                            <p><strong>How Money Works in the Economy:</strong></p>
                                            <ul>
                                                <li><strong>Money Supply:</strong> SAMA controls the amount of money in circulation</li>
                                                <li><strong>Inflation Control:</strong> Balanced money supply prevents excessive price increases</li>
                                                <li><strong>Economic Growth:</strong> Adequate money supply supports business growth and investment</li>
                                            </ul>
                                        `
                                    },
                                    {
                                        title: 'Saudi banking system and Islamic banking principles',
                                        content: `
                                            <h5>Saudi Banking System & Islamic Principles</h5>
                                            
                                            <p><strong>Structure of Saudi Banking:</strong></p>
                                            <ul>
                                                <li><strong>SAMA:</strong> Central bank and regulatory authority</li>
                                                <li><strong>Commercial Banks:</strong> Al Rajhi, SNB, SABB, Banque Saudi Fransi</li>
                                                <li><strong>Islamic Banks:</strong> All Saudi banks follow Sharia principles</li>
                                                <li><strong>Specialized Credit Institutions:</strong> Saudi Industrial Development Fund, Real Estate Development Fund</li>
                                            </ul>
                                            
                                            <p><strong>Core Islamic Banking Principles:</strong></p>
                                            
                                            <p><strong>1. Prohibition of Riba (Interest):</strong></p>
                                            <ul>
                                                <li>No predetermined interest rates on loans</li>
                                                <li>Profit-sharing arrangements instead</li>
                                                <li>Risk-sharing between bank and customer</li>
                                            </ul>
                                            
                                            <p><strong>2. Asset-Backed Financing:</strong></p>
                                            <ul>
                                                <li>All transactions must involve real assets</li>
                                                <li>No speculative or derivative instruments</li>
                                                <li>Clear ownership and transfer of assets</li>
                                            </ul>
                                            
                                            <p><strong>3. Prohibition of Gharar (Excessive Uncertainty):</strong></p>
                                            <ul>
                                                <li>Contracts must be clear and transparent</li>
                                                <li>No gambling or speculative activities</li>
                                                <li>Full disclosure of terms and conditions</li>
                                            </ul>
                                            
                                            <p><strong>Common Islamic Banking Products:</strong></p>
                                            <ul>
                                                <li><strong>Murabaha:</strong> Cost-plus financing for purchases</li>
                                                <li><strong>Ijarah:</strong> Islamic leasing arrangements</li>
                                                <li><strong>Musharakah:</strong> Partnership and profit-sharing investments</li>
                                                <li><strong>Sukuk:</strong> Islamic bonds backed by assets</li>
                                            </ul>
                                        `
                                    },
                                    {
                                        title: 'Types of bank accounts (checking, savings, investment)',
                                        content: `
                                            <h5>Saudi Bank Account Types</h5>
                                            
                                            <p><strong>1. Current Accounts (Checking):</strong></p>
                                            <ul>
                                                <li><strong>Purpose:</strong> Daily transactions and bill payments</li>
                                                <li><strong>Features:</strong> Debit cards, online banking, mobile apps</li>
                                                <li><strong>Minimum Balance:</strong> Usually 1,000-3,000 SAR</li>
                                                <li><strong>Fees:</strong> Monthly maintenance fees if below minimum balance</li>
                                                <li><strong>Benefits:</strong> ATM access, international transactions</li>
                                            </ul>
                                            
                                            <p><strong>2. Savings Accounts:</strong></p>
                                            <ul>
                                                <li><strong>Purpose:</strong> Emergency funds and short-term savings</li>
                                                <li><strong>Profit Sharing:</strong> Earn profits instead of interest (Sharia-compliant)</li>
                                                <li><strong>Liquidity:</strong> Easy access to funds when needed</li>
                                                <li><strong>Minimum Balance:</strong> Usually 500-1,000 SAR</li>
                                                <li><strong>Profit Rates:</strong> Typically 0.25%-1% annually</li>
                                            </ul>
                                            
                                            <p><strong>3. Investment Accounts:</strong></p>
                                            <ul>
                                                <li><strong>Fixed Deposits:</strong> Higher profits for locked-in periods</li>
                                                <li><strong>Investment Funds:</strong> Diversified Sharia-compliant investments</li>
                                                <li><strong>Structured Products:</strong> Capital-protected investment options</li>
                                                <li><strong>Minimum Investment:</strong> Usually 10,000-50,000 SAR</li>
                                            </ul>
                                            
                                            <p><strong>Choosing the Right Account:</strong></p>
                                            <ul>
                                                <li><strong>Current Account:</strong> For monthly salary and daily expenses</li>
                                                <li><strong>Savings Account:</strong> For emergency fund (3-6 months expenses)</li>
                                                <li><strong>Investment Account:</strong> For long-term wealth building</li>
                                                <li><strong>Multiple Accounts:</strong> Many people maintain all three types</li>
                                            </ul>
                                        `
                                    },
                                    {
                                        title: 'Understanding interest (riba) vs profit sharing in Islamic finance',
                                        content: `
                                            <h5>Riba vs Profit Sharing in Islamic Finance</h5>
                                            
                                            <p><strong>What is Riba?</strong></p>
                                            <p>Riba literally means "increase" or "growth" and refers to any predetermined increase on a principal amount, which is prohibited in Islamic finance.</p>
                                            
                                            <p><strong>Types of Riba:</strong></p>
                                            <ul>
                                                <li><strong>Riba al-Nasiah:</strong> Interest on loans and deposits</li>
                                                <li><strong>Riba al-Fadl:</strong> Unequal exchange of same commodities</li>
                                                <li><strong>Why Prohibited:</strong> Exploits the needy and creates economic imbalance</li>
                                            </ul>
                                            
                                            <p><strong>Islamic Alternative: Profit Sharing</strong></p>
                                            
                                            <p><strong>1. Mudarabah (Profit-Loss Sharing):</strong></p>
                                            <ul>
                                                <li>Bank provides capital, customer provides expertise</li>
                                                <li>Profits shared according to pre-agreed ratios</li>
                                                <li>Losses borne by capital provider (bank)</li>
                                                <li>Customer not liable for losses unless due to negligence</li>
                                            </ul>
                                            
                                            <p><strong>2. Musharakah (Partnership):</strong></p>
                                            <ul>
                                                <li>Both parties contribute capital and expertise</li>
                                                <li>Profits and losses shared according to capital contribution</li>
                                                <li>Joint ownership and management</li>
                                            </ul>
                                            
                                            <p><strong>Key Differences:</strong></p>
                                            <ul>
                                                <li><strong>Risk Sharing:</strong> Islamic finance shares risk, interest transfers all risk to borrower</li>
                                                <li><strong>Asset Backing:</strong> Islamic financing tied to real assets, interest can be pure money lending</li>
                                                <li><strong>Fairness:</strong> Profits fluctuate with performance, interest is fixed regardless of outcomes</li>
                                                <li><strong>Economic Impact:</strong> Promotes real economic activity vs speculation</li>
                                            </ul>
                                            
                                            <p><strong>Practical Examples:</strong></p>
                                            <ul>
                                                <li><strong>Home Purchase:</strong> Bank buys house, sells to you at profit vs traditional mortgage</li>
                                                <li><strong>Business Financing:</strong> Partnership in business vs loan with interest</li>
                                                <li><strong>Savings Account:</strong> Share in bank's profits vs guaranteed interest</li>
                                            </ul>
                                        `
                                    },
                                    {
                                        title: 'How to read bank statements and manage accounts',
                                        content: `
                                            <h5>Reading Bank Statements & Account Management</h5>
                                            
                                            <p><strong>Understanding Your Bank Statement:</strong></p>
                                            
                                            <p><strong>1. Account Information:</strong></p>
                                            <ul>
                                                <li><strong>Account Number:</strong> Your unique account identifier</li>
                                                <li><strong>IBAN:</strong> International Bank Account Number for transfers</li>
                                                <li><strong>Statement Period:</strong> Usually monthly (Islamic calendar months)</li>
                                                <li><strong>Branch Code:</strong> Your bank branch identifier</li>
                                            </ul>
                                            
                                            <p><strong>2. Transaction Details:</strong></p>
                                            <ul>
                                                <li><strong>Date:</strong> When transaction occurred (Hijri and Gregorian)</li>
                                                <li><strong>Description:</strong> Type of transaction (salary, ATM, transfer)</li>
                                                <li><strong>Reference:</strong> Transaction ID for tracking</li>
                                                <li><strong>Debit/Credit:</strong> Money out (-) or money in (+)</li>
                                                <li><strong>Balance:</strong> Account balance after each transaction</li>
                                            </ul>
                                            
                                            <p><strong>3. Important Sections:</strong></p>
                                            <ul>
                                                <li><strong>Opening Balance:</strong> Balance at start of period</li>
                                                <li><strong>Total Credits:</strong> All money received</li>
                                                <li><strong>Total Debits:</strong> All money spent</li>
                                                <li><strong>Closing Balance:</strong> Final balance</li>
                                                <li><strong>Profit Calculation:</strong> How Islamic profit was calculated</li>
                                            </ul>
                                            
                                            <p><strong>Account Management Best Practices:</strong></p>
                                            
                                            <p><strong>1. Regular Monitoring:</strong></p>
                                            <ul>
                                                <li>Check account daily through mobile app</li>
                                                <li>Review monthly statements carefully</li>
                                                <li>Set up SMS alerts for transactions</li>
                                                <li>Monitor for unauthorized transactions</li>
                                            </ul>
                                            
                                            <p><strong>2. Maintain Minimum Balance:</strong></p>
                                            <ul>
                                                <li>Avoid maintenance fees</li>
                                                <li>Qualify for better profit rates</li>
                                                <li>Access to premium services</li>
                                            </ul>
                                            
                                            <p><strong>3. Organize Your Finances:</strong></p>
                                            <ul>
                                                <li>Separate accounts for different purposes</li>
                                                <li>Automate recurring payments</li>
                                                <li>Keep records of important transactions</li>
                                                <li>Plan for Zakat calculations</li>
                                            </ul>
                                        `
                                    }
                                ],
                                resources: [
                                    { title: 'SAMA Banking Guide', link: '#', icon: 'book' },
                                    { title: 'Islamic Finance Basics', link: '#', icon: 'mosque' },
                                    { title: 'Personal Banking Worksheet', link: '#', icon: 'file-alt' }
                                ],
                                resourceContent: [
                                    {
                                        title: 'SAMA Banking Guide',
                                        content: `
                                            <h5>SAMA Official Banking Guide</h5>
                                            
                                            <p><strong>About SAMA (Saudi Arabian Monetary Authority):</strong></p>
                                            <p>Established in 1952, SAMA is the central bank of Saudi Arabia responsible for monetary policy, banking supervision, and maintaining financial stability.</p>
                                            
                                            <p><strong>Key Banking Regulations:</strong></p>
                                            
                                            <p><strong>1. Consumer Protection:</strong></p>
                                            <ul>
                                                <li>Banks must clearly disclose all fees and charges</li>
                                                <li>Customers have right to file complaints</li>
                                                <li>Banks must resolve complaints within 15 business days</li>
                                                <li>Alternative dispute resolution available</li>
                                            </ul>
                                            
                                            <p><strong>2. Account Opening Requirements:</strong></p>
                                            <ul>
                                                <li><strong>Saudi Citizens:</strong> National ID, salary certificate</li>
                                                <li><strong>Expatriates:</strong> Iqama, salary certificate, work permit</li>
                                                <li><strong>Minimum Age:</strong> 18 years (guardianship required for minors)</li>
                                                <li><strong>Minimum Salary:</strong> Usually 3,000 SAR per month</li>
                                            </ul>
                                            
                                            <p><strong>3. Banking Services Standards:</strong></p>
                                            <ul>
                                                <li>ATM services must be available 24/7</li>
                                                <li>Online banking with robust security measures</li>
                                                <li>Mobile banking applications</li>
                                                <li>International transfer services</li>
                                            </ul>
                                            
                                            <p><strong>4. Islamic Banking Compliance:</strong></p>
                                            <ul>
                                                <li>All products must be Sharia-compliant</li>
                                                <li>Independent Sharia boards review products</li>
                                                <li>Clear separation of Islamic and conventional activities</li>
                                                <li>Profit-sharing mechanisms instead of interest</li>
                                            </ul>
                                            
                                            <p><strong>Useful SAMA Resources:</strong></p>
                                            <ul>
                                                <li><strong>Website:</strong> sama.gov.sa</li>
                                                <li><strong>Consumer Protection:</strong> sama.sa/consumer-protection</li>
                                                <li><strong>Banking Directory:</strong> Complete list of licensed banks</li>
                                                <li><strong>Exchange Rates:</strong> Daily SAR exchange rates</li>
                                            </ul>
                                        `
                                    },
                                    {
                                        title: 'Islamic Finance Basics',
                                        content: `
                                            <h5>Islamic Finance Fundamentals</h5>
                                            
                                            <p><strong>Core Principles of Islamic Finance:</strong></p>
                                            
                                            <p><strong>1. Prohibition of Riba (Interest):</strong></p>
                                            <ul>
                                                <li>No predetermined rate of return</li>
                                                <li>Profit must be earned through legitimate trade</li>
                                                <li>Risk-sharing between parties</li>
                                                <li>Money cannot generate money without underlying economic activity</li>
                                            </ul>
                                            
                                            <p><strong>2. Prohibition of Gharar (Excessive Uncertainty):</strong></p>
                                            <ul>
                                                <li>Contracts must be clear and unambiguous</li>
                                                <li>No speculation or gambling</li>
                                                <li>Full disclosure of terms and conditions</li>
                                                <li>Tangible assets must underlie transactions</li>
                                            </ul>
                                            
                                            <p><strong>3. Prohibition of Haram Activities:</strong></p>
                                            <ul>
                                                <li>No investment in alcohol, gambling, or tobacco</li>
                                                <li>No pork-related businesses</li>
                                                <li>No conventional banking or insurance</li>
                                                <li>No weapons manufacturing</li>
                                            </ul>
                                            
                                            <p><strong>Islamic Financial Instruments:</strong></p>
                                            
                                            <p><strong>1. Murabaha (Cost-Plus Financing):</strong></p>
                                            <ul>
                                                <li>Bank purchases goods and sells to customer at profit</li>
                                                <li>Commonly used for home and car financing</li>
                                                <li>Clear disclosure of cost and profit margin</li>
                                            </ul>
                                            
                                            <p><strong>2. Ijarah (Islamic Leasing):</strong></p>
                                            <ul>
                                                <li>Bank owns asset and leases to customer</li>
                                                <li>Option to purchase at end of lease period</li>
                                                <li>Used for equipment and vehicle financing</li>
                                            </ul>
                                            
                                            <p><strong>3. Musharakah (Partnership):</strong></p>
                                            <ul>
                                                <li>Joint ownership between bank and customer</li>
                                                <li>Profits and losses shared according to agreement</li>
                                                <li>Common in business financing</li>
                                            </ul>
                                            
                                            <p><strong>4. Sukuk (Islamic Bonds):</strong></p>
                                            <ul>
                                                <li>Asset-backed securities</li>
                                                <li>Represent ownership in underlying assets</li>
                                                <li>Government and corporate sukuk available</li>
                                            </ul>
                                        `
                                    },
                                    {
                                        title: 'Personal Banking Worksheet',
                                        content: `
                                            <h5>Personal Banking Management Worksheet</h5>
                                            
                                            <p><strong>Bank Account Checklist:</strong></p>
                                            
                                            <div style="background: var(--card-bg); padding: 20px; border-radius: 10px; margin: 15px 0;">
                                                <p><strong>✓ Account Information to Track:</strong></p>
                                                <ul>
                                                    <li>□ Bank Name: ________________</li>
                                                    <li>□ Account Number: ________________</li>
                                                    <li>□ IBAN: ________________</li>
                                                    <li>□ Minimum Balance Required: _______ SAR</li>
                                                    <li>□ Monthly Fees: _______ SAR</li>
                                                    <li>□ Profit Rate: _______ %</li>
                                                </ul>
                                            </div>
                                            
                                            <p><strong>Monthly Budget Template:</strong></p>
                                            
                                            <div style="background: var(--card-bg); padding: 20px; border-radius: 10px; margin: 15px 0;">
                                                <p><strong>Income:</strong></p>
                                                <ul>
                                                    <li>Salary: _______ SAR</li>
                                                    <li>Other Income: _______ SAR</li>
                                                    <li><strong>Total Income: _______ SAR</strong></li>
                                                </ul>
                                                
                                                <p><strong>Fixed Expenses:</strong></p>
                                                <ul>
                                                    <li>Rent/Mortgage: _______ SAR</li>
                                                    <li>Utilities: _______ SAR</li>
                                                    <li>Insurance: _______ SAR</li>
                                                    <li>Bank Fees: _______ SAR</li>
                                                </ul>
                                                
                                                <p><strong>Variable Expenses:</strong></p>
                                                <ul>
                                                    <li>Food & Groceries: _______ SAR</li>
                                                    <li>Transportation: _______ SAR</li>
                                                    <li>Entertainment: _______ SAR</li>
                                                    <li>Personal: _______ SAR</li>
                                                </ul>
                                                
                                                <p><strong>Savings & Investments:</strong></p>
                                                <ul>
                                                    <li>Emergency Fund: _______ SAR</li>
                                                    <li>Investment Account: _______ SAR</li>
                                                    <li>Hajj Savings: _______ SAR</li>
                                                    <li>Zakat Provisions: _______ SAR</li>
                                                </ul>
                                            </div>
                                            
                                            <p><strong>Account Management Tips:</strong></p>
                                            <ul>
                                                <li><strong>Set Up Alerts:</strong> Get SMS for transactions above certain amount</li>
                                                <li><strong>Regular Reviews:</strong> Check statements monthly</li>
                                                <li><strong>Maintain Minimum:</strong> Avoid unnecessary fees</li>
                                                <li><strong>Plan for Zakat:</strong> Track savings for Islamic obligations</li>
                                                <li><strong>Emergency Fund:</strong> Keep 3-6 months expenses in savings</li>
                                            </ul>
                                            
                                            <p><strong>Islamic Finance Goals:</strong></p>
                                            <ul>
                                                <li>□ Eliminate all riba-based transactions</li>
                                                <li>□ Build emergency fund (Sharia-compliant)</li>
                                                <li>□ Start investing in halal instruments</li>
                                                <li>□ Plan for Hajj expenses</li>
                                                <li>□ Calculate and pay Zakat regularly</li>
                                            </ul>
                                        `
                                    }
                                ]
                            },
                            {
                                title: 'Introduction to Investing',
                                icon: 'seedling',
                                concepts: [
                                    'What is investing and why should you invest?',
                                    'Difference between saving and investing',
                                    'Understanding risk and return in Sharia-compliant investing',
                                    'Basic investment vehicles: Sukuk, Islamic funds, stocks',
                                    'How Tadawul (Saudi Stock Exchange) works'
                                ],
                                resources: [
                                    { title: 'Tadawul Beginner Guide', link: '#', icon: 'chart-line' },
                                    { title: 'Islamic Investment Principles', link: '#', icon: 'balance-scale' },
                                    { title: 'Investment Goals Planner', link: '#', icon: 'target' }
                                ]
                            },
                            {
                                title: 'Basic Financial Planning',
                                icon: 'calculator',
                                concepts: [
                                    'Creating a personal budget and expense tracking',
                                    'Building an emergency fund (3-6 months expenses)',
                                    'Understanding debt and how to manage it Islamically',
                                    'Setting short-term and long-term financial goals',
                                    'Introduction to Zakat and its impact on investments'
                                ],
                                resources: [
                                    { title: 'Budget Planning Template', link: '#', icon: 'table' },
                                    { title: 'Emergency Fund Calculator', link: '#', icon: 'shield-alt' },
                                    { title: 'Zakat Investment Guide', link: '#', icon: 'hand-holding-heart' }
                                ]
                            }
                        ]
                    },
                    intermediate: {
                        title: 'Intermediate Level',
                        description: 'Build advanced strategies and market analysis skills',
                        sections: [
                            {
                                title: 'Advanced Investment Strategies',
                                icon: 'chart-line',
                                concepts: [
                                    'Portfolio diversification across sectors and asset classes',
                                    'Understanding market cycles and timing',
                                    'Technical analysis basics for stock evaluation',
                                    'Fundamental analysis: reading financial statements',
                                    'Vision 2030 investment opportunities and sectors'
                                ],
                                resources: [
                                    { title: 'Portfolio Management Guide', link: '#', icon: 'briefcase' },
                                    { title: 'Technical Analysis Course', link: '#', icon: 'chart-area' },
                                    { title: 'Vision 2030 Investment Map', link: '#', icon: 'map' }
                                ]
                            },
                            {
                                title: 'Risk Management',
                                icon: 'shield-alt',
                                concepts: [
                                    'Types of investment risks and how to mitigate them',
                                    'Position sizing and portfolio allocation strategies',
                                    'Stop-loss strategies in Islamic investing',
                                    'Insurance as risk management (Takaful)',
                                    'Currency risk in international investments'
                                ],
                                resources: [
                                    { title: 'Risk Assessment Tool', link: '#', icon: 'tachometer-alt' },
                                    { title: 'Takaful vs Insurance Guide', link: '#', icon: 'umbrella' },
                                    { title: 'Risk Management Checklist', link: '#', icon: 'clipboard-check' }
                                ]
                            },
                            {
                                title: 'Market Analysis & Research',
                                icon: 'search',
                                concepts: [
                                    'How to research and analyze Saudi companies',
                                    'Understanding market indicators and economic factors',
                                    'Using financial ratios for stock valuation',
                                    'Sector analysis: oil, petrochemicals, banking, real estate',
                                    'Global market influences on Saudi markets'
                                ],
                                resources: [
                                    { title: 'Company Analysis Framework', link: '#', icon: 'building' },
                                    { title: 'Economic Indicators Dashboard', link: '#', icon: 'chart-pie' },
                                    { title: 'Sector Analysis Reports', link: '#', icon: 'industry' }
                                ]
                            }
                        ]
                    },
                    advanced: {
                        title: 'Advanced Level', 
                        description: 'Master complex strategies and professional techniques',
                        sections: [
                            {
                                title: 'Advanced Portfolio Management',
                                icon: 'trophy',
                                concepts: [
                                    'Modern Portfolio Theory and asset allocation models',
                                    'Alternative investments: REITs, commodities, private equity',
                                    'International diversification while maintaining Sharia compliance',
                                    'Tax optimization strategies for high-net-worth individuals',
                                    'Estate planning and wealth transfer in Islamic context'
                                ],
                                resources: [
                                    { title: 'Advanced Portfolio Models', link: '#', icon: 'project-diagram' },
                                    { title: 'Alternative Investment Guide', link: '#', icon: 'gem' },
                                    { title: 'Islamic Estate Planning', link: '#', icon: 'users' }
                                ]
                            },
                            {
                                title: 'Professional Trading Strategies',
                                icon: 'robot',
                                concepts: [
                                    'Advanced technical analysis and chart patterns',
                                    'Algorithmic trading within Islamic guidelines',
                                    'Options and derivatives (Sharia-compliant structures)',
                                    'Market making and liquidity provision',
                                    'Institutional investment strategies'
                                ],
                                resources: [
                                    { title: 'Advanced Technical Analysis', link: '#', icon: 'chart-bar' },
                                    { title: 'Islamic Derivatives Guide', link: '#', icon: 'cogs' },
                                    { title: 'Professional Trading Tools', link: '#', icon: 'tools' }
                                ]
                            },
                            {
                                title: 'Business & Investment Analysis',
                                icon: 'building',
                                concepts: [
                                    'DCF modeling and business valuation techniques',
                                    'Private equity and venture capital in Saudi Arabia',
                                    'Real estate investment analysis and REIT evaluation',
                                    'Merger & acquisition analysis',
                                    'Creating investment thesis and due diligence processes'
                                ],
                                resources: [
                                    { title: 'DCF Modeling Course', link: '#', icon: 'calculator' },
                                    { title: 'PE/VC Market Report', link: '#', icon: 'rocket' },
                                    { title: 'Due Diligence Checklist', link: '#', icon: 'tasks' }
                                ]
                            }
                        ]
                    }
                }
            },
            us: {
                name: 'United States 🇺🇸',
                currency: 'USD',
                symbol: '$',
                videos: [
                    { 
                        title: 'NYSE & NASDAQ Basics', 
                        duration: '16:45', 
                        icon: 'chart-line',
                        description: 'Understanding the major US stock exchanges and how they operate',
                        content: `
                            <h5>NYSE & NASDAQ Trading Guide</h5>
                            
                            <p><strong>NYSE (New York Stock Exchange):</strong></p>
                            <ul>
                                <li>Founded in 1792, world's largest stock exchange by market cap</li>
                                <li>Hybrid auction market with human traders and electronic systems</li>
                                <li>Home to blue-chip companies like Apple, Microsoft, Google</li>
                                <li>Trading hours: 9:30 AM - 4:00 PM EST</li>
                            </ul>
                            
                            <p><strong>NASDAQ:</strong></p>
                            <ul>
                                <li>Founded in 1971, first electronic stock exchange</li>
                                <li>Fully electronic trading platform</li>
                                <li>Technology and growth companies dominate</li>
                                <li>Same trading hours as NYSE</li>
                            </ul>
                            
                            <p><strong>Key Differences:</strong></p>
                            <ul>
                                <li><strong>Market Structure:</strong> NYSE has market makers, NASDAQ has multiple dealers</li>
                                <li><strong>Listing Requirements:</strong> NYSE generally more stringent</li>
                                <li><strong>Company Types:</strong> NYSE favors established companies, NASDAQ tech-focused</li>
                            </ul>
                            
                            <p><strong>How to Trade:</strong></p>
                            <ol>
                                <li>Open a brokerage account (Schwab, Fidelity, TD Ameritrade)</li>
                                <li>Fund your account</li>
                                <li>Research stocks using financial statements and analysis</li>
                                <li>Place buy/sell orders through your broker's platform</li>
                            </ol>
                        `
                    },
                    { 
                        title: '401k vs IRA Explained', 
                        duration: '13:30', 
                        icon: 'piggy-bank',
                        description: 'Compare retirement account options and maximize your savings',
                        content: `
                            <h5>401k vs IRA: Complete Comparison</h5>
                            
                            <p><strong>401(k) Plans:</strong></p>
                            <ul>
                                <li><strong>Contribution Limit (2024):</strong> $23,000 ($30,500 if 50+)</li>
                                <li><strong>Employer Match:</strong> Often provided (free money!)</li>
                                <li><strong>Vesting:</strong> May have vesting schedule for employer contributions</li>
                                <li><strong>Investment Options:</strong> Limited to plan's offerings</li>
                                <li><strong>Loans:</strong> Can borrow up to 50% of balance</li>
                            </ul>
                            
                            <p><strong>IRA (Individual Retirement Account):</strong></p>
                            <ul>
                                <li><strong>Contribution Limit (2024):</strong> $7,000 ($8,000 if 50+)</li>
                                <li><strong>Investment Flexibility:</strong> Can invest in almost anything</li>
                                <li><strong>No Employer Required:</strong> Anyone with earned income can open</li>
                                <li><strong>Two Types:</strong> Traditional (tax-deferred) vs Roth (tax-free growth)</li>
                            </ul>
                            
                            <p><strong>Traditional vs Roth:</strong></p>
                            <ul>
                                <li><strong>Traditional:</strong> Tax deduction now, pay taxes in retirement</li>
                                <li><strong>Roth:</strong> No tax deduction now, tax-free withdrawals in retirement</li>
                                <li><strong>Choose Roth if:</strong> You expect higher tax rate in retirement</li>
                                <li><strong>Choose Traditional if:</strong> You want immediate tax savings</li>
                            </ul>
                            
                            <p><strong>Strategy:</strong></p>
                            <ol>
                                <li>Contribute enough to 401k to get full employer match</li>
                                <li>Max out Roth IRA if eligible</li>
                                <li>Return to 401k to maximize contributions</li>
                                <li>Consider backdoor Roth if income too high for direct Roth</li>
                            </ol>
                        `
                    },
                    { 
                        title: 'ETF Investment Strategies', 
                        duration: '19:15', 
                        icon: 'layer-group',
                        description: 'Learn how to build diversified portfolios using ETFs',
                        content: `
                            <h5>ETF Investment Strategies</h5>
                            
                            <p><strong>What are ETFs?</strong></p>
                            <p>Exchange-Traded Funds are baskets of securities that trade like individual stocks, offering instant diversification at low cost.</p>
                            
                            <p><strong>Types of ETFs:</strong></p>
                            <ul>
                                <li><strong>Index ETFs:</strong> Track market indexes (S&P 500, NASDAQ)</li>
                                <li><strong>Sector ETFs:</strong> Focus on specific industries (tech, healthcare)</li>
                                <li><strong>International ETFs:</strong> Provide global exposure</li>
                                <li><strong>Bond ETFs:</strong> Fixed-income investments</li>
                                <li><strong>Commodity ETFs:</strong> Gold, oil, agriculture</li>
                            </ul>
                            
                            <p><strong>Popular ETF Strategies:</strong></p>
                            
                            <p><strong>1. Core-Satellite Strategy:</strong></p>
                            <ul>
                                <li>Core: 70-80% in broad market ETFs (VTI, VXUS)</li>
                                <li>Satellite: 20-30% in specialized ETFs for growth</li>
                                <li>Benefits: Diversification with targeted exposure</li>
                            </ul>
                            
                            <p><strong>2. Three-Fund Portfolio:</strong></p>
                            <ul>
                                <li>Total Stock Market ETF (60%)</li>
                                <li>International Stock ETF (20%)</li>
                                <li>Bond ETF (20%)</li>
                                <li>Simple, low-cost, globally diversified</li>
                            </ul>
                            
                            <p><strong>3. Factor Investing:</strong></p>
                            <ul>
                                <li>Value ETFs: Focus on undervalued companies</li>
                                <li>Growth ETFs: High-growth potential companies</li>
                                <li>Small-cap ETFs: Smaller company exposure</li>
                                <li>Dividend ETFs: Focus on dividend-paying stocks</li>
                            </ul>
                            
                            <p><strong>Key Benefits:</strong></p>
                            <ul>
                                <li>Low expense ratios (often under 0.20%)</li>
                                <li>Instant diversification</li>
                                <li>Tax efficiency</li>
                                <li>Liquidity - trade during market hours</li>
                            </ul>
                        `
                    },
                    { 
                        title: 'Tax-Advantaged Investing', 
                        duration: '17:00', 
                        icon: 'receipt',
                        description: 'Minimize taxes and maximize returns through smart account strategies',
                        content: `
                            <h5>Tax-Advantaged Investing Strategies</h5>
                            
                            <p><strong>Tax-Advantaged Account Types:</strong></p>
                            
                            <p><strong>1. 401(k) & Traditional IRA:</strong></p>
                            <ul>
                                <li>Tax deduction in contribution year</li>
                                <li>Tax-deferred growth</li>
                                <li>Taxed as ordinary income in retirement</li>
                                <li>Required minimum distributions (RMDs) at age 73</li>
                            </ul>
                            
                            <p><strong>2. Roth IRA & Roth 401(k):</strong></p>
                            <ul>
                                <li>No upfront tax deduction</li>
                                <li>Tax-free growth and withdrawals</li>
                                <li>No RMDs during owner's lifetime</li>
                                <li>Can withdraw contributions penalty-free</li>
                            </ul>
                            
                            <p><strong>3. HSA (Health Savings Account):</strong></p>
                            <ul>
                                <li>Triple tax advantage: deductible, growth, withdrawals</li>
                                <li>Use for medical expenses at any age</li>
                                <li>After 65, withdraw for any purpose (taxed as income)</li>
                                <li>$4,150 individual / $8,300 family limit (2024)</li>
                            </ul>
                            
                            <p><strong>Asset Location Strategy:</strong></p>
                            <ul>
                                <li><strong>Tax-Deferred Accounts:</strong> Bonds, REITs, high-turnover funds</li>
                                <li><strong>Roth Accounts:</strong> Highest growth potential investments</li>
                                <li><strong>Taxable Accounts:</strong> Tax-efficient index funds, individual stocks</li>
                            </ul>
                            
                            <p><strong>Tax-Loss Harvesting:</strong></p>
                            <ul>
                                <li>Sell losing investments to offset gains</li>
                                <li>Up to $3,000 annual deduction against ordinary income</li>
                                <li>Carry forward unused losses to future years</li>
                                <li>Avoid wash sale rule (30-day repurchase restriction)</li>
                            </ul>
                            
                            <p><strong>Priority Order:</strong></p>
                            <ol>
                                <li>401k up to company match</li>
                                <li>Max out HSA if eligible</li>
                                <li>Max out Roth IRA</li>
                                <li>Complete 401k maximization</li>
                                <li>Taxable investment accounts</li>
                            </ol>
                        `
                    }
                ],
                educationLevels: {
                    beginner: {
                        title: 'Beginner Level',
                        description: 'Master the fundamentals of investing and financial planning',
                        sections: [
                            {
                                title: 'Understanding Money & Banking',
                                icon: 'coins',
                                concepts: [
                                    'What is money and how does the Federal Reserve work?',
                                    'US banking system and different types of financial institutions',
                                    'Types of bank accounts (checking, savings, money market)',
                                    'Understanding compound interest and APY',
                                    'FDIC insurance and how to protect your deposits'
                                ],
                                resources: [
                                    { title: 'Federal Reserve Education', link: '#', icon: 'university' },
                                    { title: 'Banking Basics Guide', link: '#', icon: 'book' },
                                    { title: 'Account Comparison Tool', link: '#', icon: 'balance-scale' }
                                ]
                            },
                            {
                                title: 'Introduction to Investing',
                                icon: 'seedling',
                                concepts: [
                                    'What is investing and the power of compound growth?',
                                    'Stocks, bonds, and mutual funds explained',
                                    'Understanding risk vs return in US markets',
                                    'How NYSE and NASDAQ exchanges work',
                                    'Introduction to index funds and ETFs'
                                ],
                                resources: [
                                    { title: 'Investing 101 Course', link: '#', icon: 'graduation-cap' },
                                    { title: 'Stock Market Basics', link: '#', icon: 'chart-line' },
                                    { title: 'ETF Selection Guide', link: '#', icon: 'layer-group' }
                                ]
                            },
                            {
                                title: 'Basic Financial Planning',
                                icon: 'calculator',
                                concepts: [
                                    'Creating a budget with the 50/30/20 rule',
                                    'Building an emergency fund (3-6 months expenses)',
                                    'Understanding good debt vs bad debt',
                                    'Credit scores and how they affect your finances',
                                    'Setting SMART financial goals'
                                ],
                                resources: [
                                    { title: 'Budget Planning Tool', link: '#', icon: 'calculator' },
                                    { title: 'Credit Score Guide', link: '#', icon: 'credit-card' },
                                    { title: 'Goal Setting Worksheet', link: '#', icon: 'target' }
                                ]
                            }
                        ]
                    },
                    intermediate: {
                        title: 'Intermediate Level',
                        description: 'Build advanced strategies and market analysis skills',
                        sections: [
                            {
                                title: 'Advanced Investment Strategies',
                                icon: 'chart-line',
                                concepts: [
                                    'Asset allocation and modern portfolio theory',
                                    'Dollar-cost averaging and market timing strategies', 
                                    'Growth vs value investing approaches',
                                    'International diversification with global ETFs',
                                    'Tax-loss harvesting and rebalancing strategies'
                                ],
                                resources: [
                                    { title: 'Portfolio Allocation Guide', link: '#', icon: 'pie-chart' },
                                    { title: 'Investment Strategy Comparison', link: '#', icon: 'balance-scale' },
                                    { title: 'Rebalancing Calculator', link: '#', icon: 'sync' }
                                ]
                            },
                            {
                                title: 'Retirement & Tax Planning',
                                icon: 'piggy-bank',
                                concepts: [
                                    '401(k), 403(b), and employer matching strategies',
                                    'Traditional vs Roth IRA comparison and conversion',
                                    'Tax-advantaged accounts: HSA, 529 plans',
                                    'Social Security optimization strategies',
                                    'Estate planning basics and beneficiary designations'
                                ],
                                resources: [
                                    { title: '401k Optimization Guide', link: '#', icon: 'briefcase' },
                                    { title: 'Roth Conversion Calculator', link: '#', icon: 'exchange-alt' },
                                    { title: 'Social Security Planner', link: '#', icon: 'user-clock' }
                                ]
                            },
                            {
                                title: 'Market Analysis & Research',
                                icon: 'search',
                                concepts: [
                                    'Fundamental analysis: reading financial statements',
                                    'Technical analysis and chart patterns',
                                    'Economic indicators and market cycles',
                                    'Sector rotation strategies',
                                    'Using financial ratios for stock valuation'
                                ],
                                resources: [
                                    { title: 'Financial Statement Analysis', link: '#', icon: 'file-invoice-dollar' },
                                    { title: 'Technical Analysis Tools', link: '#', icon: 'chart-area' },
                                    { title: 'Economic Calendar', link: '#', icon: 'calendar-alt' }
                                ]
                            }
                        ]
                    },
                    advanced: {
                        title: 'Advanced Level',
                        description: 'Master complex strategies and professional techniques',
                        sections: [
                            {
                                title: 'Advanced Portfolio Management',
                                icon: 'trophy',
                                concepts: [
                                    'Factor investing and smart beta strategies',
                                    'Alternative investments: REITs, commodities, private equity',
                                    'Options strategies for income and hedging',
                                    'Tax optimization for high-net-worth individuals',
                                    'Multi-asset portfolio construction and risk parity'
                                ],
                                resources: [
                                    { title: 'Factor Investing Guide', link: '#', icon: 'project-diagram' },
                                    { title: 'Options Strategies Manual', link: '#', icon: 'cogs' },
                                    { title: 'Alternative Investment Analysis', link: '#', icon: 'gem' }
                                ]
                            },
                            {
                                title: 'Professional Trading & Analysis',
                                icon: 'robot',
                                concepts: [
                                    'Quantitative analysis and algorithmic trading',
                                    'Derivatives: futures, swaps, and complex instruments',
                                    'Risk management and position sizing models',
                                    'Market microstructure and execution algorithms',
                                    'Behavioral finance and market psychology'
                                ],
                                resources: [
                                    { title: 'Quantitative Methods Course', link: '#', icon: 'calculator' },
                                    { title: 'Derivatives Handbook', link: '#', icon: 'random' },
                                    { title: 'Risk Management Tools', link: '#', icon: 'shield-alt' }
                                ]
                            },
                            {
                                title: 'Business & Investment Analysis',
                                icon: 'building',
                                concepts: [
                                    'DCF modeling and business valuation techniques',
                                    'Merger & acquisition analysis',
                                    'Private equity and venture capital evaluation',
                                    'Real estate investment analysis and REITs',
                                    'Creating comprehensive investment thesis'
                                ],
                                resources: [
                                    { title: 'Valuation Models Library', link: '#', icon: 'chart-bar' },
                                    { title: 'M&A Analysis Framework', link: '#', icon: 'handshake' },
                                    { title: 'Due Diligence Checklist', link: '#', icon: 'tasks' }
                                ]
                            }
                        ]
                    }
                }
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Show market selector on page load
            document.getElementById('marketSelector').style.display = 'flex';
        });

        // Market selection
        function selectMarket(market) {
            currentMarket = market;
            currentCurrency = marketData[market].currency;
            
            // Hide market selector
            document.getElementById('marketSelector').style.display = 'none';
            
            // Show main content
            document.getElementById('financialContent').classList.add('active');
            
            // Update market indicator
            document.getElementById('currentMarket').textContent = marketData[market].name;
            
            // Update currency buttons
            updateCurrencyButtons();
            
            // Don't populate concepts on initial load - wait for level selection
            showLevel('beginner'); // Show beginner by default
        }

        // Currency switching
        function switchCurrency(currency) {
            currentCurrency = currency;
            updateCurrencyButtons();
            // Update calculator displays if needed
        }

        function updateCurrencyButtons() {
            document.getElementById('sarBtn').classList.toggle('active', currentCurrency === 'SAR');
            document.getElementById('usdBtn').classList.toggle('active', currentCurrency === 'USD');
        }

        // Content population
        function populateVideos() {
            const videoGrid = document.getElementById('videoGrid');
            const videos = marketData[currentMarket].videos;
            
            videoGrid.innerHTML = videos.map(video => `
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="video-card" onclick="playVideo('${video.title}')">
                        <div class="video-thumbnail">
                            <i class="fas fa-${video.icon}"></i>
                        </div>
                        <div class="video-title">${video.title}</div>
                        <div class="video-duration">${video.duration}</div>
                    </div>
                </div>
            `).join('');
        }

        // Level-based education content
        function showLevel(level) {
            // Update active level buttons
            document.querySelectorAll('.level-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelector(`.${level}-level`).classList.add('active');
            
            // Show level content
            const levelContent = document.getElementById('levelContent');
            const levelData = marketData[currentMarket].educationLevels[level];
            
            levelContent.innerHTML = `
                <div class="level-content active">
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="alert alert-info">
                                <h5><i class="fas fa-graduation-cap"></i> ${levelData.title}</h5>
                                <p class="mb-0">${levelData.description}</p>
                            </div>
                        </div>
                    </div>
                    ${levelData.sections.map((section, sectionIndex) => `
                        <div class="concept-section">
                            <h5><i class="fas fa-${section.icon}"></i> ${section.title}</h5>
                            <ul class="concept-list">
                                ${section.concepts.map((concept, conceptIndex) => `
                                    <li><strong>•</strong> <span class="clickable-concept" onclick="showConceptExplanation('${level}', ${sectionIndex}, ${conceptIndex})" style="cursor: pointer; color: var(--accent); text-decoration: underline;">${concept}</span></li>
                                `).join('')}
                            </ul>
                            <div class="resource-links">
                                ${section.resources.map((resource, resourceIndex) => `
                                    <a href="#" onclick="showResource('${level}', ${sectionIndex}, ${resourceIndex}); return false;" class="resource-link">
                                        <i class="fas fa-${resource.icon}"></i> ${resource.title}
                                    </a>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Interactive functions
        function toggleConcept(index) {
            const content = document.getElementById(`content-${index}`);
            const chevron = document.getElementById(`chevron-${index}`);
            const card = content.parentElement;
            
            if (content.classList.contains('show')) {
                content.classList.remove('show');
                chevron.style.transform = 'rotate(0deg)';
                card.classList.remove('expanded');
            } else {
                content.classList.add('show');
                chevron.style.transform = 'rotate(180deg)';
                card.classList.add('expanded');
            }
        }

        function playVideo(title) {
            // Find video content
            const videos = marketData[currentMarket].videos;
            const video = videos.find(v => v.title === title);
            
            if (!video) {
                alert('Video content not found');
                return;
            }
            
            // Create modal for video content
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                backdrop-filter: blur(5px);
            `;
            
            modal.innerHTML = `
                <div style="
                    background: var(--card-bg);
                    border: 1px solid var(--border-color);
                    border-radius: 20px;
                    padding: 40px;
                    max-width: 800px;
                    max-height: 80vh;
                    overflow-y: auto;
                    width: 90%;
                    position: relative;
                    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
                ">
                    <button onclick="this.closest('.video-modal').remove()" style="
                        position: absolute;
                        top: 15px;
                        right: 20px;
                        background: none;
                        border: none;
                        font-size: 1.5rem;
                        color: var(--text-secondary);
                        cursor: pointer;
                        width: 30px;
                        height: 30px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border-radius: 50%;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.background='var(--border-color)'" onmouseout="this.style.background='none'">×</button>
                    
                    <div style="text-align: center; margin-bottom: 30px;">
                        <div style="
                            background: var(--accent);
                            height: 120px;
                            width: 120px;
                            border-radius: 50%;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            margin: 0 auto 20px;
                            color: white;
                            font-size: 2.5rem;
                        ">
                            <i class="fas fa-${video.icon}"></i>
                        </div>
                        <h3 style="color: var(--text-primary); margin-bottom: 10px;">${video.title}</h3>
                        <div style="color: var(--text-secondary); margin-bottom: 5px;">
                            <i class="fas fa-clock"></i> ${video.duration}
                        </div>
                        <p style="color: var(--text-secondary); font-style: italic;">${video.description}</p>
                    </div>
                    
                    <div style="color: var(--text-primary); line-height: 1.6;">
                        ${video.content}
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <div style="
                            background: rgba(var(--accent-rgb), 0.1);
                            border: 1px solid var(--accent);
                            border-radius: 10px;
                            padding: 15px;
                            color: var(--accent);
                        ">
                            <i class="fas fa-info-circle"></i> 
                            This educational content is designed to help you understand fundamental concepts in ${currentMarket === 'saudi' ? 'Saudi Arabian' : 'US'} financial markets.
                        </div>
                    </div>
                </div>
            `;
            
            modal.className = 'video-modal';
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            // Close modal on Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    modal.remove();
                }
            }, { once: true });
        }

        // Calculator functions
        function getCurrencySymbol() {
            return currentCurrency === 'SAR' ? 'ر.س' : '$';
        }

        function formatCurrency(amount) {
            const symbol = getCurrencySymbol();
            return `${symbol}${amount.toLocaleString()}`;
        }

        function calculateCompound() {
            const principal = parseFloat(document.getElementById('principal').value);
            const monthly = parseFloat(document.getElementById('monthly').value);
            const rate = parseFloat(document.getElementById('rate').value) / 100;
            const years = parseInt(document.getElementById('years').value);
            
            const monthlyRate = rate / 12;
            const totalMonths = years * 12;
            
            // Compound interest formula with regular contributions
            const futureValue = principal * Math.pow(1 + monthlyRate, totalMonths) +
                               monthly * ((Math.pow(1 + monthlyRate, totalMonths) - 1) / monthlyRate);
            
            const totalContributions = principal + (monthly * totalMonths);
            const totalGrowth = futureValue - totalContributions;
            
            document.getElementById('compoundResult').style.display = 'block';
            document.querySelector('#compoundResult .result-value').textContent = 
                `Final Amount: ${formatCurrency(Math.round(futureValue))}`;
            document.querySelector('#compoundResult .result-details').innerHTML = `
                Total Contributions: ${formatCurrency(totalContributions)}<br>
                Investment Growth: ${formatCurrency(Math.round(totalGrowth))}<br>
                Growth Percentage: ${((totalGrowth/totalContributions)*100).toFixed(1)}%
            `;
        }

        function calculatePE() {
            const stockPrice = parseFloat(document.getElementById('stockPrice').value);
            const eps = parseFloat(document.getElementById('eps').value);
            
            const peRatio = stockPrice / eps;
            let interpretation = '';
            
            if (peRatio < 15) {
                interpretation = 'Low P/E - Potentially undervalued or slow growth';
            } else if (peRatio < 25) {
                interpretation = 'Moderate P/E - Fairly valued';
            } else {
                interpretation = 'High P/E - Growth expectations or potentially overvalued';
            }
            
            document.getElementById('peResult').style.display = 'block';
            document.querySelector('#peResult .result-value').textContent = 
                `P/E Ratio: ${peRatio.toFixed(2)}`;
            document.querySelector('#peResult .result-details').innerHTML = `
                Stock Price: ${formatCurrency(stockPrice)}<br>
                Earnings Per Share: ${formatCurrency(eps)}<br>
                Interpretation: ${interpretation}
            `;
        }

        function calculateEmergencyFund() {
            const monthlyExpenses = parseFloat(document.getElementById('monthlyExpenses').value);
            const months = parseInt(document.getElementById('jobStability').value);
            
            const recommendedAmount = monthlyExpenses * months;
            const monthlySavings = recommendedAmount / 12;
            
            document.getElementById('emergencyResult').style.display = 'block';
            document.querySelector('#emergencyResult .result-value').textContent = 
                `Recommended Amount: ${formatCurrency(recommendedAmount)}`;
            document.querySelector('#emergencyResult .result-details').innerHTML = `
                Coverage: ${months} months of expenses<br>
                Monthly Savings Goal: ${formatCurrency(Math.round(monthlySavings))} (if saving over 1 year)<br>
                This fund should be kept in a high-yield savings account for easy access.
            `;
        }

        function calculateRetirement() {
            const currentAge = parseInt(document.getElementById('currentAge').value);
            const retirementAge = parseInt(document.getElementById('retirementAge').value);
            const monthlySavings = parseFloat(document.getElementById('monthlySavings').value);
            const returnRate = parseFloat(document.getElementById('returnRate').value) / 100;
            
            const yearsToRetirement = retirementAge - currentAge;
            const monthsToRetirement = yearsToRetirement * 12;
            const monthlyRate = returnRate / 12;
            
            // Future value of annuity formula
            const futureValue = monthlySavings * ((Math.pow(1 + monthlyRate, monthsToRetirement) - 1) / monthlyRate);
            const totalContributions = monthlySavings * monthsToRetirement;
            const growth = futureValue - totalContributions;
            
            // 4% withdrawal rule
            const annualWithdrawal = futureValue * 0.04;
            const monthlyWithdrawal = annualWithdrawal / 12;
            
            document.getElementById('retirementResult').style.display = 'block';
            document.querySelector('#retirementResult .result-value').textContent = 
                `Projected Retirement Fund: ${formatCurrency(Math.round(futureValue))}`;
            document.querySelector('#retirementResult .result-details').innerHTML = `
                Years to Retirement: ${yearsToRetirement} years<br>
                Total Contributions: ${formatCurrency(totalContributions)}<br>
                Investment Growth: ${formatCurrency(Math.round(growth))}<br>
                Safe Monthly Withdrawal (4% rule): ${formatCurrency(Math.round(monthlyWithdrawal))}
            `;
        }

        // What If Investment Calculator
        function calculateWhatIf() {
            const purchaseType = document.getElementById('purchaseType').value;
            const investmentDate = parseInt(document.getElementById('investmentDate').value);
            const stockChoice = document.getElementById('stockChoice').value;
            
            // Get investment amount
            let investmentAmount;
            if (purchaseType === 'custom') {
                investmentAmount = parseFloat(document.getElementById('customAmount').value);
            } else {
                const amounts = {
                    'flagship_phone': 4500,
                    'luxury_watch': 15000,
                    'designer_bag': 8000,
                    'gaming_setup': 12000,
                    'vacation': 20000
                };
                investmentAmount = amounts[purchaseType];
            }
            
            // Get stock return rate
            const stockReturns = {
                'sabic': 0.08,
                'aramco': 0.12,
                'rajhi': 0.10,
                'snb': 0.09,
                'sp500': 0.10,
                'tesla': 0.25,
                'apple': 0.15
            };
            
            const stockNames = {
                'sabic': 'SABIC (2010)',
                'aramco': 'Saudi Aramco (2380)',
                'rajhi': 'Al Rajhi Bank (1120)',
                'snb': 'Saudi National Bank (1180)',
                'sp500': 'S&P 500 Index',
                'tesla': 'Tesla (TSLA)',
                'apple': 'Apple (AAPL)'
            };
            
            const returnRate = stockReturns[stockChoice];
            const currentValue = investmentAmount * Math.pow(1 + returnRate, investmentDate);
            const profit = currentValue - investmentAmount;
            const profitPercentage = ((profit / investmentAmount) * 100).toFixed(1);
            
            // Get purchase description
            const purchaseNames = {
                'flagship_phone': 'Latest Flagship Phone',
                'luxury_watch': 'Luxury Watch',
                'designer_bag': 'Designer Bag',
                'gaming_setup': 'Gaming Setup',
                'vacation': 'Luxury Vacation',
                'custom': 'Custom Purchase'
            };
            
            document.getElementById('whatIfResult').style.display = 'block';
            document.querySelector('#whatIfResult .result-value').innerHTML = `
                <div style="color: #28a745; font-size: 1.2em; font-weight: bold;">
                    Your ${formatCurrency(investmentAmount)} would be worth ${formatCurrency(Math.round(currentValue))} today!
                </div>
            `;
            document.querySelector('#whatIfResult .result-details').innerHTML = `
                <strong>Instead of buying:</strong> ${purchaseNames[purchaseType]}<br>
                <strong>If invested in:</strong> ${stockNames[stockChoice]}<br>
                <strong>Investment Period:</strong> ${investmentDate} year${investmentDate > 1 ? 's' : ''} ago<br>
                <strong>Total Profit:</strong> ${formatCurrency(Math.round(profit))}<br>
                <strong>Return:</strong> +${profitPercentage}%<br><br>
                <div style="background: rgba(40, 167, 69, 0.1); padding: 10px; border-radius: 8px; margin-top: 10px;">
                    💡 <strong>Motivation:</strong> This shows the power of investing instead of spending on depreciating assets!
                </div>
            `;
        }

        // Rent vs Buy Calculator
        function calculateRentVsBuy() {
            const monthlyRent = parseFloat(document.getElementById('monthlyRent').value);
            const rentIncrease = parseFloat(document.getElementById('rentIncrease').value) / 100;
            const homePrice = parseFloat(document.getElementById('homePrice').value);
            const downPaymentPercent = parseFloat(document.getElementById('downPayment').value) / 100;
            const mortgageRate = parseFloat(document.getElementById('mortgageRate').value) / 100;
            const timePeriod = parseInt(document.getElementById('timePeriod').value);
            
            // Rent calculations
            let totalRentCost = 0;
            let currentRent = monthlyRent;
            for (let year = 0; year < timePeriod; year++) {
                totalRentCost += currentRent * 12;
                currentRent *= (1 + rentIncrease);
            }
            
            // Buy calculations
            const downPayment = homePrice * downPaymentPercent;
            const loanAmount = homePrice - downPayment;
            const monthlyRate = mortgageRate / 12;
            const totalPayments = timePeriod * 12;
            
            // Monthly mortgage payment (principal + interest)
            const monthlyMortgage = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, totalPayments)) / 
                                   (Math.pow(1 + monthlyRate, totalPayments) - 1);
            
            const totalMortgagePayments = monthlyMortgage * totalPayments;
            const totalInterest = totalMortgagePayments - loanAmount;
            
            // Estimate home appreciation (3% annually)
            const homeAppreciation = 0.03;
            const futureHomeValue = homePrice * Math.pow(1 + homeAppreciation, timePeriod);
            
            // Total cost of buying (down payment + mortgage payments + estimated maintenance)
            const maintenanceCost = homePrice * 0.01 * timePeriod; // 1% per year
            const totalBuyingCost = downPayment + totalMortgagePayments + maintenanceCost;
            
            // Net position after selling
            const netPositionBuying = futureHomeValue - totalBuyingCost;
            const netPositionRenting = -totalRentCost; // Negative because it's all expense
            
            const difference = netPositionBuying - netPositionRenting;
            const betterOption = difference > 0 ? 'buying' : 'renting';
            
            document.getElementById('rentBuyResult').style.display = 'block';
            
            if (betterOption === 'buying') {
                document.querySelector('#rentBuyResult .result-value').innerHTML = `
                    <div style="color: #28a745; font-size: 1.1em; font-weight: bold;">
                        🏠 Buying is better by ${formatCurrency(Math.abs(Math.round(difference)))}
                    </div>
                `;
            } else {
                document.querySelector('#rentBuyResult .result-value').innerHTML = `
                    <div style="color: #dc3545; font-size: 1.1em; font-weight: bold;">
                        🗝️ Renting is better by ${formatCurrency(Math.abs(Math.round(difference)))}
                    </div>
                `;
            }
            
            document.querySelector('#rentBuyResult .result-details').innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <strong>🗝️ Renting Costs:</strong><br>
                        Total Rent: ${formatCurrency(Math.round(totalRentCost))}<br>
                        Final Monthly Rent: ${formatCurrency(Math.round(currentRent))}<br>
                        Net Position: ${formatCurrency(Math.round(netPositionRenting))}
                    </div>
                    <div class="col-md-6">
                        <strong>🏠 Buying Costs:</strong><br>
                        Down Payment: ${formatCurrency(Math.round(downPayment))}<br>
                        Total Mortgage: ${formatCurrency(Math.round(totalMortgagePayments))}<br>
                        Home Value: ${formatCurrency(Math.round(futureHomeValue))}<br>
                        Net Position: ${formatCurrency(Math.round(netPositionBuying))}
                    </div>
                </div>
                <div style="background: rgba(23, 162, 184, 0.1); padding: 10px; border-radius: 8px; margin-top: 15px;">
                    <strong>Analysis Period:</strong> ${timePeriod} years<br>
                    <strong>Monthly Mortgage:</strong> ${formatCurrency(Math.round(monthlyMortgage))} vs Starting Rent: ${formatCurrency(monthlyRent)}
                </div>
            `;
        }

        // Handle custom amount visibility for What If calculator
        document.getElementById('purchaseType').addEventListener('change', function() {
            const customDiv = document.getElementById('customAmountDiv');
            if (this.value === 'custom') {
                customDiv.style.display = 'block';
            } else {
                customDiv.style.display = 'none';
            }
        });

        // Financial Advisor Bot Functions
        let isTyping = false;

        // Show concept explanation
        function showConceptExplanation(level, sectionIndex, conceptIndex) {
            const levelData = marketData[currentMarket].educationLevels[level];
            const section = levelData.sections[sectionIndex];
            const explanation = section.conceptExplanations[conceptIndex];
            
            if (!explanation) {
                alert('Detailed explanation coming soon!');
                return;
            }
            
            // Create modal for concept explanation
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                backdrop-filter: blur(5px);
            `;
            
            modal.innerHTML = `
                <div style="
                    background: var(--card-bg);
                    border: 1px solid var(--border-color);
                    border-radius: 20px;
                    padding: 40px;
                    max-width: 900px;
                    max-height: 80vh;
                    overflow-y: auto;
                    width: 90%;
                    position: relative;
                    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
                ">
                    <button onclick="this.closest('.concept-modal').remove()" style="
                        position: absolute;
                        top: 15px;
                        right: 20px;
                        background: none;
                        border: none;
                        font-size: 1.5rem;
                        color: var(--text-secondary);
                        cursor: pointer;
                        width: 30px;
                        height: 30px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border-radius: 50%;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.background='var(--border-color)'" onmouseout="this.style.background='none'">×</button>
                    
                    <div style="color: var(--text-primary); line-height: 1.6;">
                        ${explanation.content}
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <div style="
                            background: rgba(var(--accent-rgb), 0.1);
                            border: 1px solid var(--accent);
                            border-radius: 10px;
                            padding: 15px;
                            color: var(--accent);
                        ">
                            <i class="fas fa-lightbulb"></i> 
                            This explanation is part of the <strong>${levelData.title}</strong> curriculum for ${currentMarket === 'saudi' ? 'Saudi Arabian' : 'US'} financial education.
                        </div>
                    </div>
                </div>
            `;
            
            modal.className = 'concept-modal';
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            // Close modal on Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    modal.remove();
                }
            }, { once: true });
        }

        // Show resource content
        function showResource(level, sectionIndex, resourceIndex) {
            const levelData = marketData[currentMarket].educationLevels[level];
            const section = levelData.sections[sectionIndex];
            const resource = section.resources[resourceIndex];
            const resourceContent = section.resourceContent && section.resourceContent[resourceIndex];
            
            if (!resourceContent) {
                alert('Resource content coming soon!');
                return;
            }
            
            // Create modal for resource content
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                backdrop-filter: blur(5px);
            `;
            
            modal.innerHTML = `
                <div style="
                    background: var(--card-bg);
                    border: 1px solid var(--border-color);
                    border-radius: 20px;
                    padding: 40px;
                    max-width: 900px;
                    max-height: 80vh;
                    overflow-y: auto;
                    width: 90%;
                    position: relative;
                    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
                ">
                    <button onclick="this.closest('.resource-modal').remove()" style="
                        position: absolute;
                        top: 15px;
                        right: 20px;
                        background: none;
                        border: none;
                        font-size: 1.5rem;
                        color: var(--text-secondary);
                        cursor: pointer;
                        width: 30px;
                        height: 30px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border-radius: 50%;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.background='var(--border-color)'" onmouseout="this.style.background='none'">×</button>
                    
                    <div style="text-align: center; margin-bottom: 30px;">
                        <div style="
                            background: var(--accent);
                            height: 80px;
                            width: 80px;
                            border-radius: 50%;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            margin: 0 auto 20px;
                            color: white;
                            font-size: 2rem;
                        ">
                            <i class="fas fa-${resource.icon}"></i>
                        </div>
                        <h3 style="color: var(--text-primary); margin-bottom: 10px;">${resource.title}</h3>
                    </div>
                    
                    <div style="color: var(--text-primary); line-height: 1.6;">
                        ${resourceContent.content}
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <div style="
                            background: rgba(var(--accent-rgb), 0.1);
                            border: 1px solid var(--accent);
                            border-radius: 10px;
                            padding: 15px;
                            color: var(--accent);
                        ">
                            <i class="fas fa-download"></i> 
                            This resource is provided as part of the ${currentMarket === 'saudi' ? 'Saudi Arabian' : 'US'} Financial Literacy program.
                        </div>
                    </div>
                </div>
            `;
            
            modal.className = 'resource-modal';
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            // Close modal on Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    modal.remove();
                }
            }, { once: true });
        }

        // Knowledge base for financial advice
        const financialKnowledge = {
            'start investing': {
                keywords: ['start', 'begin', 'investing', 'investment', 'beginner'],
                response: `To start investing, follow these steps:
                
1. **Build an emergency fund** - Save 3-6 months of expenses
2. **Pay off high-interest debt** - Credit cards, personal loans
3. **Choose an investment account** - ${currentMarket === 'saudi' ? 'Tadawul brokerage account or mutual funds' : '401(k), IRA, or taxable brokerage'}
4. **Start with diversified funds** - ${currentMarket === 'saudi' ? 'Saudi equity funds or diversified portfolios' : 'Index funds or ETFs covering broad markets'}
5. **Invest consistently** - Set up automatic monthly contributions

Remember: Start small, stay consistent, and think long-term!`
            },
            'diversification': {
                keywords: ['diversification', 'diversify', 'spread', 'risk'],
                response: `Diversification means spreading your investments across different:

• **Asset classes** - Stocks, bonds, real estate
• **Geographic regions** - ${currentMarket === 'saudi' ? 'Saudi, GCC, international markets' : 'US, international, emerging markets'}
• **Sectors** - Technology, healthcare, finance, energy
• **Company sizes** - Large-cap, mid-cap, small-cap stocks

Benefits:
✓ Reduces overall portfolio risk
✓ Smoother returns over time
✓ Protection against single investment failures

The saying goes: "Don't put all your eggs in one basket!"`
            },
            'retirement': {
                keywords: ['retirement', 'retire', 'pension', 'old age'],
                response: `Retirement planning guidelines:

**How much to save:**
• Save 10-15% of your income for retirement
• Use the 4% withdrawal rule for planning
• ${currentMarket === 'saudi' ? 'Consider GOSI benefits in your calculations' : 'Maximize employer 401(k) match'}

**Where to invest:**
• ${currentMarket === 'saudi' ? 'Long-term savings accounts, mutual funds, Tadawul stocks' : '401(k), Traditional/Roth IRA, taxable accounts'}
• Focus on growth investments when young
• Gradually shift to conservative investments as you age

**Start early:** Time is your biggest advantage due to compound interest!`
            },
            'compound interest': {
                keywords: ['compound', 'interest', 'growth', 'calculation'],
                response: `Compound interest is "earning interest on your interest"

**Formula:** A = P(1 + r/n)^(nt)
• A = Final amount
• P = Principal (initial investment)
• r = Annual interest rate (as decimal)
• n = Number of times interest compounds per year
• t = Time in years

**Example:** ${formatCurrency(10000)} at 7% annually for 30 years:
${formatCurrency(10000)} × (1.07)^30 = ${formatCurrency(76123)}

The magic happens over time - the longer you invest, the more powerful compounding becomes!`
            },
            'accounts': {
                keywords: ['account', 'accounts', 'where', 'invest'],
                response: currentMarket === 'saudi' ? 
                `**Saudi Investment Accounts:**

• **Tadawul Direct** - Trade individual stocks
• **Bank Investment Accounts** - Managed portfolios
• **Mutual Funds** - Diversified, professionally managed
• **Islamic Investment Funds** - Sharia-compliant options
• **Regular Savings** - High-yield savings accounts

**Best for beginners:** Start with mutual funds or bank investment products for diversification and professional management.` :
                `**US Investment Accounts:**

• **401(k)** - Employer-sponsored, often with matching
• **Traditional IRA** - Tax-deductible contributions
• **Roth IRA** - Tax-free growth and withdrawals
• **Taxable Brokerage** - No contribution limits, more flexibility
• **HSA** - Triple tax advantage for healthcare

**Priority order:** 401(k) match → High-interest debt → IRA → Taxable account`
            }
        };

        function findBestResponse(question) {
            const lowerQuestion = question.toLowerCase();
            
            for (const [topic, data] of Object.entries(financialKnowledge)) {
                if (data.keywords.some(keyword => lowerQuestion.includes(keyword))) {
                    return data.response;
                }
            }
            
            // Default responses for common patterns
            if (lowerQuestion.includes('tax')) {
                return currentMarket === 'saudi' ? 
                `**Saudi Tax Information:**
                
• No personal income tax in Saudi Arabia
• Zakat may apply to certain investments (2.5% annually)
• Capital gains from Tadawul trading are generally tax-free
• Always consult with a local tax advisor for personal situations` :
                `**US Tax Basics:**
                
• Long-term capital gains (>1 year): 0%, 15%, or 20% rates
• Short-term capital gains (<1 year): Taxed as ordinary income
• Traditional IRA/401(k): Tax-deferred growth
• Roth IRA/401(k): Tax-free growth
                
Consult a tax professional for personalized advice.`;
            }
            
            if (lowerQuestion.includes('risk')) {
                return `**Investment Risk Management:**
                
• **Diversification** - Spread investments across different assets
• **Time horizon** - Longer investing periods reduce risk
• **Asset allocation** - Balance stocks, bonds, and cash
• **Emergency fund** - Keep 3-6 months expenses in cash
• **Don't invest money you need within 5 years**
                
Risk and return are related - higher potential returns typically mean higher risk.`;
            }
            
            // Generic helpful response
            return `I'd be happy to help you with financial questions! I can provide information about:

• Investment basics and strategies
• Retirement planning
• Compound interest calculations  
• Account types and tax implications
• Risk management and diversification
• ${currentMarket === 'saudi' ? 'Saudi/Islamic finance principles' : 'US tax-advantaged accounts'}

Try asking about specific topics like "How do I start investing?" or "What is diversification?"

*Disclaimer: This is educational information only, not personalized financial advice.*`;
        }

        function addMessage(message, isUser = false) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${isUser ? 'message-user' : 'message-bot'}`;
            
            const contentDiv = document.createElement('div');
            contentDiv.innerHTML = message.replace(/\n/g, '<br>');
            messageDiv.appendChild(contentDiv);
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showTypingIndicator() {
            const messagesContainer = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing-indicator';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <span>Financial Advisor is typing</span>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const sendBtn = document.getElementById('sendBtn');
            const question = input.value.trim();
            
            if (!question || isTyping) return;
            
            // Add user message
            addMessage(question, true);
            input.value = '';
            
            // Show typing indicator
            isTyping = true;
            sendBtn.disabled = true;
            showTypingIndicator();
            
            // Simulate thinking time
            await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));
            
            // Remove typing indicator and add response
            removeTypingIndicator();
            const response = findBestResponse(question);
            addMessage(response);
            
            isTyping = false;
            sendBtn.disabled = false;
        }

        function askQuickQuestion(question) {
            document.getElementById('chatInput').value = question;
            sendMessage();
        }

        // Chat input handling
        document.addEventListener('DOMContentLoaded', function() {
            const chatInput = document.getElementById('chatInput');
            
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // Auto-resize textarea
            chatInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 100) + 'px';
            });
        });
    </script>
</body>
</html>